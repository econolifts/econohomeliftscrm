<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Econo Home Lifts - Professional CRM and Service Management System">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Econo Lifts">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230f172a' width='100' height='100'/><rect x='20' y='20' width='60' height='60' fill='none' stroke='%233b82f6' stroke-width='4' rx='4'/><rect x='25' y='25' width='50' height='25' fill='%233b82f6' rx='2'/><line x1='20' y1='50' x2='80' y2='50' stroke='%233b82f6' stroke-width='3'/><path d='M 35 60 L 40 55 L 45 60' fill='none' stroke='%233b82f6' stroke-width='3'/><path d='M 55 70 L 60 75 L 65 70' fill='none' stroke='%233b82f6' stroke-width='3'/></svg>">
<title>Econo Home Lifts CRM</title>
<link rel="icon" type="image/png" href="data:image/png;base64,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7V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICpvPav7snbPzP/WQ57V/dk7Z+Z/6yLZewppH73Fs93t/RD2FNI/e4tnu9v6ICBtBdqe8NQtWqHZ9T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">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
/* Modern Dark Mode Design */
:root {
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --bg-tertiary: #334155;
  --bg-card: #1e293b;
  --bg-hover: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --accent-primary: #3b82f6;
  --accent-secondary: #10b981;
  --accent-warning: #f59e0b;
  --accent-danger: #ef4444;
  --accent-purple: #8b5cf6;
  --border-color: #334155;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: var(--text-primary);
  min-height: 100vh;
  padding: 20px;
  line-height: 1.6;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--bg-tertiary);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-primary);
}

/* Form Elements */
button, input, select, textarea {
  padding: 12px 16px;
  margin: 8px 0;
  font-size: 15px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  width: 100%;
  background: var(--bg-secondary);
  color: var(--text-primary);
  transition: var(--transition);
  font-family: inherit;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--accent-primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

input::placeholder, textarea::placeholder {
  color: var(--text-muted);
}

/* Buttons */
button {
  background: linear-gradient(135deg, var(--accent-primary) 0%, #2563eb 100%);
  color: white;
  border: none;
  font-weight: 600;
  cursor: pointer;
  touch-action: manipulation;
  box-shadow: var(--shadow);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 14px;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

button:active {
  transform: translateY(0);
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.btn-success {
  background: linear-gradient(135deg, var(--accent-secondary) 0%, #059669 100%);
}

.btn-danger {
  background: linear-gradient(135deg, var(--accent-danger) 0%, #dc2626 100%);
}

.btn-secondary {
  background: linear-gradient(135deg, var(--bg-tertiary) 0%, #475569 100%);
}

.btn-warning {
  background: linear-gradient(135deg, var(--accent-warning) 0%, #d97706 100%);
  color: #000;
}

.btn-small {
  padding: 8px 12px;
  font-size: 13px;
  margin: 2px;
  display: inline-block;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  background: var(--bg-secondary);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--shadow);
}

th, td {
  border: 1px solid var(--border-color);
  padding: 14px 12px;
  text-align: left;
  font-size: 14px;
}

th {
  background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
  color: white;
  font-weight: 600;
  position: sticky;
  top: 0;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 0.5px;
}

tr:hover {
  background: var(--bg-hover);
  transition: var(--transition);
}

/* Cards */
.card {
  background: var(--bg-card);
  padding: 24px;
  margin: 15px 0;
  border-radius: 16px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border-color);
  transition: var(--transition);
}

.card:hover {
  box-shadow: var(--shadow-lg);
  transform: translateY(-2px);
}

h1, h2, h3 {
  margin: 15px 0;
  color: var(--text-primary);
  font-weight: 700;
}

h1 { font-size: 28px; }
h2 { font-size: 24px; }
h3 { font-size: 20px; }

/* Login Box */
#loginBox {
  max-width: 450px;
  margin: 60px auto;
  background: var(--bg-card);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-color);
}

#adminApp, #techApp {
  display: none;
}

/* Status Colors */
.status-open {
  background: rgba(245, 158, 11, 0.15);
  color: #fbbf24;
  border-left: 3px solid var(--accent-warning);
}

.status-done {
  background: rgba(16, 185, 129, 0.15);
  color: #34d399;
  border-left: 3px solid var(--accent-secondary);
}

.status-overdue {
  background: rgba(239, 68, 68, 0.15);
  color: #f87171;
  border-left: 3px solid var(--accent-danger);
}

.status-faulty {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
  color: #fca5a5;
  border-left: 4px solid var(--accent-danger);
}

.status-incomplete {
  background: rgba(245, 158, 11, 0.15);
  color: #fbbf24;
  border-left: 3px solid var(--accent-warning);
}

/* Badges */
.reminder-badge {
  display: inline-block;
  background: linear-gradient(135deg, var(--accent-danger) 0%, #dc2626 100%);
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 11px;
  margin-left: 8px;
  font-weight: 700;
  box-shadow: var(--shadow);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Tabs */
.tab-container {
  display: flex;
  margin-bottom: 20px;
  overflow-x: auto;
  gap: 8px;
  background: var(--bg-secondary);
  padding: 8px;
  border-radius: 12px;
}

.tab {
  flex: 1;
  min-width: 100px;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border: none;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  border-radius: 8px;
  transition: var(--transition);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tab:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.tab.active {
  background: linear-gradient(135deg, var(--accent-primary) 0%, #2563eb 100%);
  color: white;
  box-shadow: var(--shadow);
}

.tab-content {
  display: none;
  animation: fadeIn 0.3s ease-in;
}

.tab-content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Notes */
.note-item {
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%);
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  font-size: 13px;
  border-left: 3px solid var(--accent-warning);
}

.note-time {
  font-size: 11px;
  color: var(--text-muted);
}

#logoutBtn {
  background: linear-gradient(135deg, var(--accent-danger) 0%, #dc2626 100%);
  margin-top: 15px;
}

textarea {
  min-height: 100px;
  resize: vertical;
  font-family: inherit;
}

.scroll-table {
  overflow-x: auto;
  border-radius: 12px;
}

/* Map Link */
.map-link {
  display: inline-block;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: white;
  padding: 10px 16px;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
  margin: 8px 0;
  transition: var(--transition);
  font-weight: 600;
  box-shadow: var(--shadow);
}

.map-link:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.address-text {
  font-size: 13px;
  color: var(--text-secondary);
  margin: 8px 0;
}

/* Help Text */
.help-text {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.1) 100%);
  padding: 16px;
  border-radius: 12px;
  margin: 15px 0;
  font-size: 14px;
  border-left: 4px solid var(--accent-primary);
  color: var(--text-secondary);
}

.help-text code {
  background: var(--bg-tertiary);
  padding: 2px 8px;
  border-radius: 4px;
  font-family: 'Courier New', monospace;
  color: var(--accent-primary);
  font-size: 13px;
}

.reset-link {
  color: var(--accent-danger);
  cursor: pointer;
  text-decoration: underline;
  font-size: 13px;
  display: block;
  text-align: center;
  margin-top: 20px;
  transition: var(--transition);
}

.reset-link:hover {
  color: #fca5a5;
}

/* Panel Headers */
.panel-header {
  background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
  color: white;
  padding: 20px;
  margin: -20px -20px 20px -20px;
  border-radius: 16px 16px 0 0;
  text-align: center;
  box-shadow: var(--shadow);
}

.panel-header.tech {
  background: linear-gradient(135deg, var(--accent-secondary) 0%, #059669 100%);
}

/* Modals */
div[id$="Modal"] {
  backdrop-filter: blur(4px);
}

div[id$="Modal"] > div {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Links */
a {
  color: var(--accent-primary);
  transition: var(--transition);
}

a:hover {
  color: #60a5fa;
}

/* Loading Animation */
@keyframes shimmer {
  0% { background-position: -1000px 0; }
  100% { background-position: 1000px 0; }
}

/* Contact Info Footer */
.contact-footer {
  text-align: center;
  margin-top: 20px;
  padding: 16px;
  background: var(--bg-secondary);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  font-size: 13px;
  color: var(--text-secondary);
}

.contact-footer a {
  color: var(--accent-primary);
  text-decoration: none;
  font-weight: 600;
}

.contact-footer a:hover {
  text-decoration: underline;
}

/* Special Effects */
.glow {
  box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
}

/* Responsive */
@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  .card {
    padding: 16px;
  }
  
  table {
    font-size: 12px;
  }
  
  th, td {
    padding: 8px 6px;
  }
  
  .tab {
    font-size: 11px;
    padding: 10px 8px;
  }
  
  .kanban-container {
    flex-direction: column;
  }
}

/* KPI Cards - Zoho/Monday Style */
.kpi-card {
  background: var(--bg-card);
  padding: 20px;
  border-radius: 12px;
  border: 1px solid var(--border-color);
  box-shadow: var(--shadow);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.kpi-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
}

.kpi-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.kpi-icon {
  font-size: 36px;
  margin-bottom: 10px;
}

.kpi-value {
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
  margin: 5px 0;
}

.kpi-label {
  font-size: 13px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 5px 0;
}

.kpi-change {
  font-size: 12px;
  margin-top: 8px;
  padding: 4px 8px;
  border-radius: 6px;
  display: inline-block;
}

.kpi-change.positive {
  background: rgba(16, 185, 129, 0.15);
  color: #34d399;
}

.kpi-change.negative {
  background: rgba(239, 68, 68, 0.15);
  color: #f87171;
}

/* Activity Feed */
.activity-item {
  padding: 12px;
  border-left: 3px solid var(--accent-primary);
  background: var(--bg-secondary);
  margin: 8px 0;
  border-radius: 6px;
  font-size: 13px;
  transition: var(--transition);
}

.activity-item:hover {
  background: var(--bg-hover);
  transform: translateX(4px);
}

.activity-time {
  color: var(--text-muted);
  font-size: 11px;
  margin-top: 4px;
}

.activity-icon {
  display: inline-block;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  text-align: center;
  line-height: 24px;
  margin-right: 8px;
  font-size: 12px;
}

/* Kanban Board - Monday.com Style */
.kanban-container {
  display: flex;
  gap: 15px;
  overflow-x: auto;
  padding: 10px 0;
  min-height: 500px;
}

.kanban-column {
  flex: 1;
  min-width: 300px;
  background: var(--bg-secondary);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  overflow: hidden;
}

.kanban-header {
  padding: 15px;
  color: white;
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.kanban-count {
  background: rgba(255, 255, 255, 0.3);
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
}

.kanban-content {
  padding: 15px;
  min-height: 400px;
}

.kanban-card {
  background: var(--bg-card);
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  border: 1px solid var(--border-color);
  cursor: move;
  transition: var(--transition);
  box-shadow: var(--shadow);
}

.kanban-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.kanban-card.dragging {
  opacity: 0.5;
  transform: rotate(2deg);
}

.kanban-card-title {
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.kanban-card-meta {
  font-size: 12px;
  color: var(--text-muted);
  margin: 4px 0;
}

.kanban-card-tags {
  display: flex;
  gap: 6px;
  margin-top: 8px;
  flex-wrap: wrap;
}

.kanban-tag {
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 4px;
  background: var(--bg-tertiary);
  color: var(--text-secondary);
}

.kanban-card-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--border-color);
}

/* Calendar View - Zoho Style */
.calendar-view {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
  background: var(--border-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  overflow: hidden;
}

.calendar-day-header {
  background: var(--bg-tertiary);
  padding: 10px;
  text-align: center;
  font-weight: 700;
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.calendar-day {
  background: var(--bg-card);
  padding: 10px;
  min-height: 100px;
  position: relative;
  cursor: pointer;
  transition: var(--transition);
}

.calendar-day:hover {
  background: var(--bg-hover);
}

.calendar-day.other-month {
  opacity: 0.3;
}

.calendar-day.today {
  background: rgba(59, 130, 246, 0.1);
  border: 2px solid var(--accent-primary);
}

.calendar-day.selected {
  background: rgba(16, 185, 129, 0.1);
  border: 2px solid var(--accent-secondary);
}

.calendar-day-number {
  font-weight: 700;
  margin-bottom: 5px;
  color: var(--text-primary);
}

.calendar-event {
  background: var(--accent-primary);
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  margin: 2px 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.calendar-event.service {
  background: var(--accent-secondary);
}

.calendar-event.inspection {
  background: var(--accent-purple);
}

.calendar-event.overdue {
  background: var(--accent-danger);
}

/* Search and Filters */
.filter-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.filter-bar input,
.filter-bar select {
  flex: 1;
  min-width: 200px;
  margin: 0;
}

/* Charts */
canvas {
  max-width: 100%;
}

/* Status Pills */
.status-pill {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-pill.open {
  background: rgba(245, 158, 11, 0.15);
  color: #fbbf24;
}

.status-pill.progress,
.status-pill.in-progress {
  background: rgba(59, 130, 246, 0.15);
  color: #60a5fa;
}

.status-pill.done {
  background: rgba(16, 185, 129, 0.15);
  color: #34d399;
}

/* Tooltips */
.tooltip {
  position: relative;
  cursor: help;
}

.tooltip::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  padding: 8px 12px;
  background: var(--bg-tertiary);
  color: var(--text-primary);
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: var(--transition);
  box-shadow: var(--shadow);
}

.tooltip:hover::after {
  opacity: 1;
  bottom: calc(100% + 5px);
}

/* Loading Spinner */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 23, 42, 0.8);
  backdrop-filter: blur(4px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  animation: fadeIn 0.3s ease;
}

.loading-overlay.active {
  display: flex;
}

.spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(59, 130, 246, 0.2);
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.spinner-container {
  text-align: center;
}

.spinner-text {
  color: #f1f5f9;
  margin-top: 16px;
  font-size: 14px;
  font-weight: 600;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Small inline loader */
.inline-loader {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid rgba(59, 130, 246, 0.3);
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
  vertical-align: middle;
  margin-left: 8px;
}

/* Bulk Actions Bar */
.bulk-actions-bar {
  background: var(--bg-secondary);
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 15px;
  display: none;
  align-items: center;
  gap: 10px;
  border: 1px solid var(--border-color);
}

.bulk-actions-bar.active {
  display: flex;
}

.bulk-actions-bar button {
  flex: 0 0 auto;
  width: auto;
  padding: 8px 16px;
}

/* Fault Management Styles */
.fault-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 20px;
  margin: 15px 0;
  box-shadow: var(--shadow);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.fault-card::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 6px;
}

.fault-card.urgent::before {
  background: var(--accent-danger);
  animation: pulse 2s infinite;
}

.fault-card.high::before {
  background: var(--accent-warning);
}

.fault-card.normal::before {
  background: var(--accent-primary);
}

.fault-card.low::before {
  background: var(--accent-secondary);
}

.fault-card:hover {
  transform: translateX(4px);
  box-shadow: var(--shadow-lg);
}

.fault-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 15px;
  flex-wrap: wrap;
  gap: 10px;
}

.fault-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  flex: 1;
}

.fault-priority-badge {
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.fault-priority-badge.urgent {
  background: linear-gradient(135deg, var(--accent-danger), #dc2626);
  color: white;
  box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
}

.fault-priority-badge.high {
  background: linear-gradient(135deg, var(--accent-warning), #d97706);
  color: #000;
}

.fault-priority-badge.normal {
  background: linear-gradient(135deg, var(--accent-primary), #2563eb);
  color: white;
}

.fault-priority-badge.low {
  background: linear-gradient(135deg, var(--accent-secondary), #059669);
  color: white;
}

.fault-meta {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
  margin: 15px 0;
  padding: 15px;
  background: var(--bg-secondary);
  border-radius: 8px;
}

.fault-meta-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}

.fault-meta-item .icon {
  font-size: 18px;
}

.fault-description {
  background: rgba(239, 68, 68, 0.1);
  border-left: 3px solid var(--accent-danger);
  padding: 15px;
  border-radius: 6px;
  margin: 15px 0;
  font-size: 14px;
  line-height: 1.6;
}

.fault-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.fault-actions button {
  flex: 0 0 auto;
  width: auto;
  padding: 10px 20px;
  margin: 0;
}

.fault-timeline {
  border-left: 3px solid var(--accent-primary);
  margin: 15px 0 15px 20px;
  padding-left: 20px;
}

.fault-timeline-item {
  position: relative;
  padding-bottom: 20px;
}

.fault-timeline-item::before {
  content: '';
  position: absolute;
  left: -26px;
  top: 5px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--accent-primary);
  border: 3px solid var(--bg-card);
}

.fault-timeline-date {
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 4px;
}

.fault-timeline-text {
  font-size: 14px;
  color: var(--text-secondary);
}

.fault-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  margin: 20px 0;
}

.fault-stat {
  text-align: center;
  padding: 15px;
  background: var(--bg-secondary);
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.fault-stat-value {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
}

.fault-stat-label {
  font-size: 12px;
  color: var(--text-muted);
  text-transform: uppercase;
  margin-top: 5px;
}
</style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
  <div class="spinner-container">
    <div class="spinner"></div>
    <div class="spinner-text">Processing...</div>
  </div>
</div>

<div id="loginBox" class="card">
<div style="text-align:center;margin-bottom:20px"><svg width="300" height="60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 60">
  <defs>
    <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Lift Icon with modern design -->
  <g transform="translate(5, 8)">
    <!-- Elevator shaft outline -->
    <rect x="0" y="0" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2.5" rx="4"/>
    
    <!-- Elevator car -->
    <rect x="4" y="4" width="36" height="20" fill="url(#logoGrad)" rx="2"/>
    
    <!-- Doors -->
    <line x1="21" y1="6" x2="21" y2="22" stroke="#1e293b" stroke-width="1.5"/>
    <circle cx="17" cy="14" r="1.5" fill="#1e293b"/>
    <circle cx="25" cy="14" r="1.5" fill="#1e293b"/>
    
    <!-- Floor indicator -->
    <line x1="0" y1="24" x2="44" y2="24" stroke="url(#logoGrad)" stroke-width="1.5"/>
    
    <!-- Up/Down arrows -->
    <path d="M 12 32 L 16 28 L 20 32" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
    <path d="M 24 36 L 28 40 L 32 36" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
  </g>
  
  <!-- Company Text -->
  <text x="58" y="28" font-family="Arial, sans-serif" font-size="22" font-weight="700" fill="#3b82f6">ECONO</text>
  <text x="140" y="28" font-family="Arial, sans-serif" font-size="14" font-weight="400" fill="#cbd5e1">Home Lifts</text>
  <text x="58" y="48" font-family="Arial, sans-serif" font-size="10" fill="#94a3b8">Service Management System</text>
</svg></div>
<h2> Login</h2>
<select id="loginType" onchange="updateLoginPlaceholders()">
<option value="admin">Admin</option>
<option value="tech">Technician</option>
</select>
<input type="text" id="username" placeholder="Username" autocomplete="username">
<input type="password" id="password" placeholder="Password" autocomplete="current-password">
<label style="display:block;margin:10px 0;text-align:left">
<input type="checkbox" id="rememberMe"> Remember me
</label>
<button onclick="login()">Login</button>
<p id="msg" style="color:red;text-align:center"></p>

<div class="help-text">
  <strong> Default Logins:</strong><br>
  <strong>Admin:</strong> Username: <code>admin</code> | Password: <code>admin123</code><br>
  <strong>Tech 1:</strong> Username: <code>john</code> | Password: <code>tech1</code><br>
  <strong>Tech 2:</strong> Username: <code>sarah</code> | Password: <code>tech2</code><br>
  <strong>Tech 3:</strong> Username: <code>ivan</code> | Password: <code>1986</code>
</div>

<div style="text-align:center;margin-top:15px;padding:10px;background:#f8f9fa;border-radius:6px">
  <div style="font-size:12px;color:#666">
     <strong>044 873 2934</strong> |  <strong><a href="/cdn-cgi/l/email-protection#dabbbeb7b3b49abfb9b5b4b5b2b5b7bfb6b3bcaea9f4b9b5f4a0bb"><span class="__cf_email__" data-cfemail="9cfdf8f1f5f2dcf9fff3f2f3f4f3f1f9f0f5fae8efb2fff3b2e6fd">[email&#160;protected]</span></a></strong><br>
     <a href="http://www.econohomelifts.co.za" target="_blank" style="color:#007bff">www.econohomelifts.co.za</a>
  </div>
</div>

<div style="text-align:center;margin-top:10px;padding:8px;font-size:11px;color:var(--text-muted);opacity:0.7">
  Developed by <strong style="color:var(--accent-primary)">Mari-Louise Uys</strong>
</div>

<span class="reset-link" onclick="resetData()"> Reset All Data (if having issues)</span>
</div>

<div id="adminApp">
<div class="panel-header">
<div style="text-align:center"><svg width="300" height="60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 60">
  <defs>
    <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Lift Icon with modern design -->
  <g transform="translate(5, 8)">
    <!-- Elevator shaft outline -->
    <rect x="0" y="0" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2.5" rx="4"/>
    
    <!-- Elevator car -->
    <rect x="4" y="4" width="36" height="20" fill="url(#logoGrad)" rx="2"/>
    
    <!-- Doors -->
    <line x1="21" y1="6" x2="21" y2="22" stroke="#1e293b" stroke-width="1.5"/>
    <circle cx="17" cy="14" r="1.5" fill="#1e293b"/>
    <circle cx="25" cy="14" r="1.5" fill="#1e293b"/>
    
    <!-- Floor indicator -->
    <line x1="0" y1="24" x2="44" y2="24" stroke="url(#logoGrad)" stroke-width="1.5"/>
    
    <!-- Up/Down arrows -->
    <path d="M 12 32 L 16 28 L 20 32" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
    <path d="M 24 36 L 28 40 L 32 36" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
  </g>
  
  <!-- Company Text -->
  <text x="58" y="28" font-family="Arial, sans-serif" font-size="22" font-weight="700" fill="#3b82f6">ECONO</text>
  <text x="140" y="28" font-family="Arial, sans-serif" font-size="14" font-weight="400" fill="#cbd5e1">Home Lifts</text>
  <text x="58" y="48" font-family="Arial, sans-serif" font-size="10" fill="#94a3b8">Service Management System</text>
</svg></div>
<h1 style="margin:0;font-size:24px;text-align:center">Admin Panel</h1>
<p style="margin:8px 0 0 0;font-size:14px;opacity:0.9">Logged in as: <span id="adminLoggedInName"></span></p>
</div>
<div class="tab-container">
<button class="tab active" onclick="showTab('dashboard',event)"> Dashboard</button>
<button class="tab" onclick="showTab('kanban',event)"> Kanban Board</button>
<button class="tab" onclick="showTab('calendar',event)"> Calendar</button>
<button class="tab" onclick="showTab('tracking',event)"> Tech Tracking</button>
<button class="tab" onclick="showTab('lifts',event)"> Lifts</button>
<button class="tab" onclick="showTab('faults',event)"> Faults <span id="faultsCount" class="reminder-badge" style="display:none">0</span></button>
<button class="tab" onclick="showTab('inspections',event)"> Inspections</button>
<button class="tab" onclick="showTab('techs',event)"> Techs</button>
<button class="tab" onclick="showTab('tickets',event)"> Tickets</button>
<button class="tab" onclick="showTab('reports',event)"> Reports</button>
<button class="tab" onclick="showTab('reminders',event)"> Reminders <span id="reminderCount" class="reminder-badge" style="display:none">0</span></button>
<button class="tab" onclick="showTab('admins',event)"> Admins</button>
<button class="tab" onclick="showTab('settings',event)"> Settings</button>
</div>

<!-- Dashboard Tab -->
<div id="dashboard-tab" class="tab-content active">
<div class="card">
<h2> Business Overview</h2>
<p style="color:var(--text-muted);font-size:14px">Real-time metrics and insights for your lift service business</p>
</div>

<!-- KPI Cards -->
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin-bottom:20px">
<div class="kpi-card">
<div class="kpi-icon"></div>
<div class="kpi-value" id="kpi-total-lifts">0</div>
<div class="kpi-label">Total Lifts</div>
<div class="kpi-change positive">+0 this month</div>
</div>

<div class="kpi-card">
<div class="kpi-icon"></div>
<div class="kpi-value" id="kpi-open-tickets">0</div>
<div class="kpi-label">Open Tickets</div>
<div class="kpi-change" id="kpi-tickets-change">0 pending</div>
</div>

<div class="kpi-card">
<div class="kpi-icon"></div>
<div class="kpi-value" id="kpi-completed-month">0</div>
<div class="kpi-label">Completed This Month</div>
<div class="kpi-change positive">+0 from last month</div>
</div>

<div class="kpi-card">
<div class="kpi-icon"></div>
<div class="kpi-value" id="kpi-overdue">0</div>
<div class="kpi-label">Overdue Services</div>
<div class="kpi-change negative" id="kpi-overdue-change">Action needed</div>
</div>

<div class="kpi-card">
<div class="kpi-icon"></div>
<div class="kpi-value" id="kpi-active-techs">0</div>
<div class="kpi-label">Active Technicians</div>
<div class="kpi-change">0 working today</div>
</div>

</div>

<!-- Activity Feed -->
<div style="display:grid;grid-template-columns:2fr 1fr;gap:15px">
<div class="card">
<h3> Recent Activity</h3>
<div id="activity-feed" style="max-height:400px;overflow-y:auto"></div>
</div>

<div class="card">
<h3> Upcoming This Week</h3>
<div id="upcoming-tasks" style="max-height:400px;overflow-y:auto"></div>
</div>
</div>

<!-- Charts -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:15px">
<div class="card">
<h3> Services by Type</h3>
<canvas id="servicesChart" style="max-height:250px"></canvas>
</div>

<div class="card">
<h3> Monthly Performance</h3>
<canvas id="performanceChart" style="max-height:250px"></canvas>
</div>
</div>

<!-- Quick Actions -->
<div class="card">
<h3> Quick Actions</h3>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px">
<button onclick="showTab('lifts',event)" class="btn-success"> Add New Lift</button>
<button onclick="showTab('tickets',event)" class="btn-success"> Create Ticket</button>
<button onclick="showTab('techs',event)" class="btn-secondary"> Manage Technicians</button>
<button onclick="exportData()" style="background:var(--accent-purple)"> Backup Data</button>
</div>
</div>
</div>

<!-- Kanban Board Tab -->
<div id="kanban-tab" class="tab-content">
<div class="card">
<h2> Ticket Kanban Board</h2>
<p style="color:var(--text-muted);font-size:14px">Drag and drop tickets to update their status</p>

<div style="margin:15px 0">
<input type="text" id="kanban-search" placeholder=" Search tickets..." style="max-width:400px">
<select id="kanban-filter-tech" style="max-width:200px;display:inline-block;width:auto;margin-left:10px">
<option value="">All Technicians</option>
</select>
</div>
</div>

<div class="kanban-container">
<div class="kanban-column">
<div class="kanban-header" style="background:var(--accent-warning)">
<span> To Do</span>
<span class="kanban-count" id="kanban-todo-count">0</span>
</div>
<div class="kanban-content" id="kanban-todo" ondrop="drop(event,'Open')" ondragover="allowDrop(event)"></div>
</div>

<div class="kanban-column">
<div class="kanban-header" style="background:var(--accent-primary)">
<span> In Progress</span>
<span class="kanban-count" id="kanban-progress-count">0</span>
</div>
<div class="kanban-content" id="kanban-progress" ondrop="drop(event,'In Progress')" ondragover="allowDrop(event)"></div>
</div>

<div class="kanban-column">
<div class="kanban-header" style="background:var(--accent-secondary)">
<span> Completed</span>
<span class="kanban-count" id="kanban-done-count">0</span>
</div>
<div class="kanban-content" id="kanban-done" ondrop="drop(event,'Done')" ondragover="allowDrop(event)"></div>
</div>
</div>
</div>

<!-- Calendar Tab -->
<div id="calendar-tab" class="tab-content">
<div class="card">
<h2> Service Calendar</h2>
<p style="color:var(--text-muted);font-size:14px">View and manage your service schedule</p>

<div style="display:flex;justify-content:space-between;align-items:center;margin:15px 0">
<button onclick="changeMonth(-1)" class="btn-small btn-secondary"> Previous</button>
<h3 id="calendar-month-year" style="margin:0"></h3>
<button onclick="changeMonth(1)" class="btn-small btn-secondary">Next </button>
</div>

<div class="calendar-view" id="calendar-grid"></div>

<div style="margin-top:20px">
<h3> Events on Selected Date</h3>
<div id="calendar-events"></div>
</div>
</div>
</div>

<!-- Tech Tracking Tab -->
<div id="tracking-tab" class="tab-content">
<div id="tech-tracking-content"></div>
</div>

<div id="lifts-tab" class="tab-content">
<div class="card">
<h3> Add Lift</h3>
<input id="client" placeholder="Client Name">
<input id="clientAddress" placeholder="Client Address">
<input id="clientPhone" placeholder="Client Phone (with country code, e.g., 27821234567)">
<input id="lift" placeholder="Lift ID">
<select id="frequency">
<option value="1">Monthly</option>
<option value="3">3 Monthly</option>
<option value="6">6 Monthly</option>
<option value="12">Yearly</option>
</select>
<button onclick="addLift()" class="btn-success">Add Lift</button>
</div>
<div class="card">
<h3> Import Lifts from CSV</h3>
<p style="font-size:13px;color:#666">Upload a CSV file with columns: Client, Address, Phone, Lift ID, Frequency</p>
<input type="file" id="csvFileInput" accept=".csv" style="padding:8px">
<button onclick="importCSV()" class="btn-warning">Import CSV File</button>
</div>
<div class="card">
<h3> All Lifts</h3>
<div class="scroll-table">
<table>
<thead><tr><th>Client</th><th>Address</th><th>Phone</th><th>Lift ID</th><th>Frequency</th><th>Status</th><th>History</th><th>Documents</th><th>Action</th><th>Report Fault</th><th>WhatsApp</th><th>Edit/Delete</th></tr></thead>
<tbody id="liftTable"></tbody>
</table>
</div>
</div>
</div>

<div id="techs-tab" class="tab-content">
<div class="card">
<h3> Add Technician</h3>
<p style="font-size:13px;color:var(--text-muted);margin-bottom:15px">
  Create login credentials for your technicians to access their jobs on mobile
</p>

<label style="display:block;margin:10px 0 5px 0;font-weight:600;color:var(--text-primary)">
   Full Name <span style="color:#ef4444">*</span>
</label>
<input id="techName" placeholder="e.g., John Smith" style="margin-bottom:15px">

<label style="display:block;margin:10px 0 5px 0;font-weight:600;color:var(--text-primary)">
   Username <span style="color:#ef4444">*</span>
</label>
<input id="techUsername" placeholder="e.g., john (lowercase, no spaces)" style="margin-bottom:5px">
<p style="font-size:11px;color:var(--text-muted);margin:0 0 15px 0">
   Lowercase only, no spaces. Use letters, numbers, or underscores
</p>

<label style="display:block;margin:10px 0 5px 0;font-weight:600;color:var(--text-primary)">
   Password <span style="color:#ef4444">*</span>
</label>
<input id="techPass" type="password" placeholder="Create a password" style="margin-bottom:15px">

<button onclick="addTech()" class="btn-success" style="width:100%">
   Add Technician
</button>
</div>

<div class="card">
<h3> All Technicians</h3>
<p style="font-size:13px;color:var(--text-muted);margin-bottom:15px">
  Manage your team. Share login credentials with each technician.
</p>
<div class="scroll-table">
<table>
<thead><tr><th>Name</th><th>Username</th><th>Password</th><th>Delete</th></tr></thead>
<tbody id="techTable"></tbody>
</table>
</div>
</div>
</div>

<div id="admins-tab" class="tab-content">
<div class="card">
<h3> Add Admin</h3>
<input id="adminName" placeholder="Full Name">
<input id="adminUsername" placeholder="Username">
<input id="adminPass" placeholder="Password">
<button onclick="addAdmin()" class="btn-success">Add Admin</button>
</div>
<div class="card">
<h3> All Admins</h3>
<div class="scroll-table">
<table>
<thead><tr><th>Name</th><th>Username</th><th>Password</th><th>Delete</th></tr></thead>
<tbody id="adminTable"></tbody>
</table>
</div>
</div>
</div>

<!-- Faults Management Tab -->
<div id="faults-tab" class="tab-content">
<div class="card">
<h2> Fault Management System</h2>
<p style="color:var(--text-muted);font-size:14px">Comprehensive fault tracking, prioritization, and resolution management</p>

<!-- Fault Statistics -->
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0">
<div class="kpi-card" style="border-left:4px solid var(--accent-danger)">
<div class="kpi-icon"></div>
<div class="kpi-value" id="fault-urgent-count">0</div>
<div class="kpi-label">Urgent Faults</div>
</div>
<div class="kpi-card" style="border-left:4px solid var(--accent-warning)">
<div class="kpi-icon"></div>
<div class="kpi-value" id="fault-high-count">0</div>
<div class="kpi-label">High Priority</div>
</div>
<div class="kpi-card" style="border-left:4px solid var(--accent-primary)">
<div class="kpi-icon"></div>
<div class="kpi-value" id="fault-normal-count">0</div>
<div class="kpi-label">Normal Priority</div>
</div>
<div class="kpi-card" style="border-left:4px solid var(--accent-secondary)">
<div class="kpi-icon"></div>
<div class="kpi-value" id="fault-resolved-count">0</div>
<div class="kpi-label">Resolved This Month</div>
</div>
</div>

<!-- Filter and Search -->
<div class="filter-bar">
<input type="text" id="fault-search" placeholder=" Search faults by client, lift ID, or description..." onkeyup="filterFaults()">
<select id="fault-priority-filter" onchange="filterFaults()">
<option value="">All Priorities</option>
<option value="Urgent"> Urgent Only</option>
<option value="High"> High Priority</option>
<option value="Normal"> Normal</option>
<option value="Low"> Low</option>
</select>
<select id="fault-status-filter" onchange="filterFaults()">
<option value="">All Statuses</option>
<option value="Open">Open Faults</option>
<option value="In Progress">In Progress</option>
<option value="Done">Resolved</option>
</select>
</div>
</div>

<!-- Active Faults List -->
<div class="card">
<h3> Active Faults</h3>
<div id="active-faults-list"></div>
</div>

<!-- Fault Timeline -->
<div class="card">
<h3> Fault Resolution Timeline</h3>
<canvas id="faultTimelineChart" style="max-height:250px"></canvas>
</div>

<!-- Recently Resolved -->
<div class="card">
<h3> Recently Resolved Faults</h3>
<div id="resolved-faults-list"></div>
</div>
</div>

<div id="inspections-tab" class="tab-content">
<div class="card">
<h3> Lift Inspections Schedule</h3>
<p style="font-size:13px;color:#666">Track annual inspections and compliance for all lifts</p>
<div class="scroll-table">
<table>
<thead><tr><th>Client</th><th>Lift ID</th><th>Last Inspection</th><th>Next Due</th><th>Days Until Due</th><th>Status</th><th>Actions</th></tr></thead>
<tbody id="inspectionTable"></tbody>
</table>
</div>
</div>
</div>

<div id="settings-tab" class="tab-content">
<div class="card">
<h3> WhatsApp Settings</h3>
<p style="color:var(--text-muted);font-size:14px">Configure WhatsApp messaging preferences and templates</p>

<div style="margin:20px 0">
<label style="display:block;margin:10px 0;font-weight:bold"> Default Message Language:</label>
<select id="whatsappLanguage" onchange="saveWhatsAppSettings()">
<option value="en">English</option>
<option value="af">Afrikaans</option>
<option value="zu">Zulu</option>
<option value="xh">Xhosa</option>
</select>

<label style="display:block;margin:20px 0 10px 0;font-weight:bold"> Quick Reply Messages:</label>
<p style="font-size:13px;color:var(--text-muted);margin-bottom:10px">Pre-save common messages for instant sending</p>
<div id="quickRepliesList"></div>
<button onclick="openQuickReplyModal()" class="btn-success" style="margin-top:10px"> Add Quick Reply</button>
</div>

<label style="display:block;margin:20px 0 10px 0;font-weight:bold"> WhatsApp Business API (Optional):</label>
<p style="font-size:13px;color:var(--text-muted);margin-bottom:10px">Connect WhatsApp Business API for automated messaging</p>
<input type="text" id="whatsappBusinessNumber" placeholder="WhatsApp Business Number (e.g., 27821234567)">
<input type="text" id="whatsappApiKey" placeholder="API Key (from WhatsApp Business)">
<button onclick="testWhatsAppAPI()" class="btn-secondary">Test Connection</button>
</div>

<div class="card">
<h3> Backup & Restore Data</h3>
<p style="font-size:13px;color:#666">Export your data to save a backup, or import previously saved data</p>
<button onclick="exportData()" class="btn-success"> Export All Data (Download Backup)</button>
<button onclick="document.getElementById('importFileInput').click()" class="btn-warning" style="margin-top:8px"> Import Data (Restore Backup)</button>
<input type="file" id="importFileInput" accept=".json" style="display:none" onchange="importData(this)">
<p style="font-size:12px;color:#999;margin-top:10px"> Tip: Export data regularly and save to Google Drive for safekeeping!</p>
</div>

<div class="card">
<h3> Change My Password</h3>
<input type="password" id="currentPassword" placeholder="Current Password">
<input type="password" id="newPassword" placeholder="New Password">
<input type="password" id="confirmPassword" placeholder="Confirm New Password">
<button onclick="changeAdminPassword()" class="btn-warning">Change Password</button>
</div>
</div>

<!-- Quick Reply Modal -->
<div id="quickReplyModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000">
<div style="background:var(--bg-card);margin:5% auto;padding:20px;max-width:500px;border-radius:12px;border:1px solid var(--border-color)">
<h3> Create Quick Reply</h3>
<input type="text" id="quickReplyName" placeholder="Reply Name (e.g., 'Appointment Confirmation')">
<select id="quickReplyLanguage">
<option value="en">English</option>
<option value="af">Afrikaans</option>
<option value="zu">Zulu</option>
<option value="xh">Xhosa</option>
</select>
<textarea id="quickReplyMessage" placeholder="Message template... Use {client}, {liftId}, {address} for dynamic content" style="min-height:150px"></textarea>
<p style="font-size:12px;color:var(--text-muted);margin:10px 0"> Tip: Use {client} for client name, {liftId} for lift ID, {address} for address</p>
<button onclick="saveQuickReply()" class="btn-success">Save Quick Reply</button>
<button onclick="closeQuickReplyModal()" class="btn-secondary">Cancel</button>
</div>
</div>

<div id="tickets-tab" class="tab-content">
<div class="card">
<h3> Create Ticket</h3>
<select id="ticketLift"></select>
<select id="ticketTech"></select>
<select id="ticketType">
<option value="Service"> Service</option>
<option value="Faulty"> Faulty / Repair</option>
<option value="Upgrade"> Lift Upgrade</option>
<option value="New Install"> New Installation</option>
<option value="Inspection"> Inspection</option>
</select>
<input type="date" id="ticketDate" placeholder="Scheduled Date">
<textarea id="ticketNote" placeholder="Instructions / Notes"></textarea>
<label style="display:block;margin:10px 0;font-size:14px"> Attach Photos (optional):</label>
<input type="file" id="ticketPhotos" accept="image/*" multiple style="padding:8px">
<button onclick="createTicket()" class="btn-success">Create Ticket</button>
</div>
<div class="card">
<h3> All Tickets</h3>
<div class="scroll-table">
<table>
<thead><tr><th>Ticket #</th><th>Client</th><th>Lift</th><th>Address</th><th>Type</th><th>Tech</th><th>Scheduled</th><th>Status</th><th>Map</th><th>Edit/Delete</th></tr></thead>
<tbody id="adminTicketTable"></tbody>
</table>
</div>
</div>
</div>

<div id="reports-tab" class="tab-content">
<div class="card">
<h3> Service Reports</h3>
<label>Report Period:</label>
<select id="reportPeriod" onchange="generateReport()">
<option value="today">Today</option>
<option value="week">This Week</option>
<option value="month" selected>This Month</option>
<option value="year">This Year</option>
<option value="custom">Custom Range</option>
</select>
<div id="customDateRange" style="display:none;margin:10px 0">
<input type="date" id="reportStartDate">
<input type="date" id="reportEndDate">
<button onclick="generateReport()" class="btn-secondary">Generate</button>
</div>
</div>

<div class="card">
<h3> Summary Statistics</h3>
<div id="reportSummary" style="font-size:16px"></div>
</div>

<div class="card">
<h3> Services by Technician</h3>
<div class="scroll-table">
<table>
<thead><tr><th>Technician</th><th>Services Completed</th><th>Open Jobs</th><th>Total Jobs</th></tr></thead>
<tbody id="techReportTable"></tbody>
</table>
</div>
</div>

<div class="card">
<h3> Services by Client</h3>
<div class="scroll-table">
<table>
<thead><tr><th>Client</th><th>Lifts Serviced</th><th>Last Service</th></tr></thead>
<tbody id="clientReportTable"></tbody>
</table>
</div>
</div>

<div class="card">
<h3> Services by Type</h3>
<div class="scroll-table">
<table>
<thead><tr><th>Service Type</th><th>Count</th><th>Percentage</th></tr></thead>
<tbody id="typeReportTable"></tbody>
</table>
</div>
</div>
</div>

<div id="reminders-tab" class="tab-content">
<div class="card">
<h3> Maintenance Reminders</h3>
<p style="font-size:14px;color:#666">Lifts that need maintenance based on their schedule:</p>
<div id="reminderList"></div>
</div>
</div>

<div id="faulty-tab" class="tab-content">
<div class="card">
<h3> Faulty Lifts</h3>
<p style="font-size:14px;color:#666">Lifts reported as faulty by technicians:</p>
<div id="faultyList"></div>
</div>
</div>

<div id="incomplete-tab" class="tab-content">
<div class="card">
<h3> Incomplete Jobs</h3>
<p style="font-size:14px;color:#666">Jobs not completed on scheduled day:</p>
<div id="incompleteList"></div>
</div>
</div>

<button id="logoutBtn" onclick="logout()">Logout</button>

<div style="text-align:center;margin-top:20px;padding:12px;font-size:11px;color:var(--text-muted);border-top:1px solid var(--border-color)">
  <div style="opacity:0.6">Developed by <strong style="color:var(--accent-primary)">Mari-Louise Uys</strong></div>
</div>
</div>

<div id="techApp">
<div class="panel-header tech">
<div style="text-align:center"><svg width="300" height="60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 60">
  <defs>
    <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Lift Icon with modern design -->
  <g transform="translate(5, 8)">
    <!-- Elevator shaft outline -->
    <rect x="0" y="0" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2.5" rx="4"/>
    
    <!-- Elevator car -->
    <rect x="4" y="4" width="36" height="20" fill="url(#logoGrad)" rx="2"/>
    
    <!-- Doors -->
    <line x1="21" y1="6" x2="21" y2="22" stroke="#1e293b" stroke-width="1.5"/>
    <circle cx="17" cy="14" r="1.5" fill="#1e293b"/>
    <circle cx="25" cy="14" r="1.5" fill="#1e293b"/>
    
    <!-- Floor indicator -->
    <line x1="0" y1="24" x2="44" y2="24" stroke="url(#logoGrad)" stroke-width="1.5"/>
    
    <!-- Up/Down arrows -->
    <path d="M 12 32 L 16 28 L 20 32" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
    <path d="M 24 36 L 28 40 L 32 36" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
  </g>
  
  <!-- Company Text -->
  <text x="58" y="28" font-family="Arial, sans-serif" font-size="22" font-weight="700" fill="#3b82f6">ECONO</text>
  <text x="140" y="28" font-family="Arial, sans-serif" font-size="14" font-weight="400" fill="#cbd5e1">Home Lifts</text>
  <text x="58" y="48" font-family="Arial, sans-serif" font-size="10" fill="#94a3b8">Service Management System</text>
</svg></div>
<h1 style="margin:0;font-size:24px;text-align:center">Technician Panel</h1>
<h3 style="margin:8px 0 0 0;font-weight:normal;opacity:0.9" id="techTitle"></h3>
</div>
<div class="tab-container">
<button class="tab active" onclick="showTechTab('jobs',event)">My Jobs</button>
<button class="tab" onclick="showTechTab('completed',event)">Completed</button>
</div>

<div id="jobs-tab" class="tab-content active">
<div style="text-align:center;margin:10px 0">
<button onclick="refreshData();renderTech();" style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none;padding:10px 24px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;box-shadow:0 2px 8px rgba(59,130,246,0.3)">Refresh Jobs</button>
<p style="font-size:11px;color:#999;margin:4px 0 0 0">Pull latest tickets from admin</p>
</div>
<div class="card" style="background:#fee2e2;border-left:4px solid #dc2626">
<h3> Quick Fault Report</h3>
<p style="font-size:13px;margin:5px 0">Report a fault you discovered on any lift:</p>
<select id="techFaultLiftSelect" style="margin:5px 0">
<option value="">Select Lift</option>
</select>
<button onclick="openTechFaultReport()" class="btn-danger">Report Fault</button>
</div>
<div class="card">
<h3> Today's Jobs</h3>
<div id="techJobsToday"></div>
</div>
<div class="card">
<h3> All Open Jobs</h3>
<div id="techJobsAll"></div>
</div>
</div>

<div id="completed-tab" class="tab-content">
<div class="card">
<h3> Completed Jobs</h3>
<div id="techJobsCompleted"></div>
</div>
</div>

<div class="card" style="margin-top:10px">
<h3> Change My Password</h3>
<input type="password" id="techCurrentPassword" placeholder="Current Password">
<input type="password" id="techNewPassword" placeholder="New Password">
<input type="password" id="techConfirmPassword" placeholder="Confirm New Password">
<button onclick="changeTechPassword()" class="btn-warning">Change Password</button>
</div>

<button id="logoutBtn" onclick="logout()">Logout</button>

<div style="text-align:center;margin-top:20px;padding:12px;font-size:11px;color:var(--text-muted);border-top:1px solid var(--border-color)">
  <div style="opacity:0.6">Developed by <strong style="color:var(--accent-primary)">Mari-Louise Uys</strong></div>
</div>
</div>

<!-- Modal for adding notes -->
<div id="noteModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000">
<div style="background:#fff;margin:5% auto;padding:20px;max-width:400px;border-radius:8px;max-height:85%;overflow-y:auto">
<h3> Service Notes</h3>
<textarea id="serviceNote" placeholder="Enter service notes here..." style="min-height:120px"></textarea>
<label style="display:block;margin:10px 0;font-size:14px"> Add Photos:</label>
<input type="file" id="servicePhotos" accept="image/*" multiple style="padding:8px">
<div id="photoPreview" style="display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin:10px 0"></div>
<label style="display:block;margin:10px 0">
<input type="checkbox" id="markFaulty">  Mark this lift as FAULTY
</label>
<label style="display:block;margin:10px 0">
<input type="checkbox" id="markIncomplete">  Job INCOMPLETE (need to return)
</label>
<button onclick="completeJob()" class="btn-success">Complete Job</button>
<button onclick="closeNoteModal()" class="btn-secondary">Cancel</button>
</div>
</div>

<!-- Modal for editing lifts -->
<div id="editLiftModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000">
<div style="background:#fff;margin:5% auto;padding:20px;max-width:400px;border-radius:8px;max-height:85%;overflow-y:auto">
<h3> Edit Lift</h3>
<input id="editLiftClient" placeholder="Client Name">
<input id="editLiftAddress" placeholder="Client Address">
<input id="editLiftPhone" placeholder="Client Phone">
<input id="editLiftId" placeholder="Lift ID">
<select id="editLiftFrequency">
<option value="1">Monthly</option>
<option value="3">3 Monthly</option>
<option value="6">6 Monthly</option>
<option value="12">Yearly</option>
</select>
<button onclick="updateLift()" class="btn-success">Update Lift</button>
<button onclick="closeEditLiftModal()" class="btn-secondary">Cancel</button>
</div>
</div>

<!-- Modal for editing tickets -->
<div id="editTicketModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000">
<div style="background:#fff;margin:5% auto;padding:20px;max-width:400px;border-radius:8px;max-height:85%;overflow-y:auto">
<h3> Edit Ticket</h3>
<select id="editTicketLift"></select>
<select id="editTicketTech"></select>
<select id="editTicketType">
<option value="Service"> Service</option>
<option value="Faulty"> Faulty / Repair</option>
<option value="Upgrade"> Lift Upgrade</option>
<option value="New Install"> New Installation</option>
<option value="Inspection"> Inspection</option>
</select>
<input type="date" id="editTicketDate">
<textarea id="editTicketNote" placeholder="Instructions / Notes"></textarea>
<select id="editTicketStatus">
<option value="Open">Open</option>
<option value="Done">Done</option>
</select>
<button onclick="updateTicket()" class="btn-success">Update Ticket</button>
<button onclick="closeEditTicketModal()" class="btn-secondary">Cancel</button>
</div>
</div>

<!-- Modal for reporting fault -->
<div id="faultReportModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000">
<div style="background:#fff;margin:5% auto;padding:20px;max-width:400px;border-radius:8px;max-height:85%;overflow-y:auto">
<h3> Report Fault</h3>
<div style="background:#fff3cd;padding:10px;border-radius:6px;margin-bottom:15px;border-left:4px solid #ffc107">
  <strong id="faultLiftInfo"></strong>
</div>
<label style="display:block;margin:10px 0;font-weight:bold">Assign Technician:</label>
<select id="faultTechSelect"></select>
<label style="display:block;margin:10px 0;font-weight:bold">Fault Description:</label>
<textarea id="faultDescription" placeholder="Describe the fault or issue..." style="min-height:120px"></textarea>
<label style="display:block;margin:10px 0;font-weight:bold">Priority:</label>
<select id="faultPriority">
<option value="Urgent"> Urgent - Immediate attention required</option>
<option value="High"> High - Within 24 hours</option>
<option value="Normal" selected> Normal - Within 3 days</option>
<option value="Low"> Low - Schedule when convenient</option>
</select>
<button onclick="submitFaultReport()" class="btn-danger"> Create Fault Ticket</button>
<button onclick="closeFaultReportModal()" class="btn-secondary">Cancel</button>
</div>
</div>

<!-- Modal for lift history -->
<div id="liftHistoryModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000">
<div style="background:#fff;margin:3% auto;padding:20px;max-width:600px;border-radius:8px;max-height:90%;overflow-y:auto">
<h3> Service History</h3>
<div id="liftHistoryContent"></div>
<button onclick="closeLiftHistoryModal()" class="btn-secondary" style="margin-top:15px">Close</button>
</div>
</div>

<!-- Modal for lift documents -->
<div id="documentsModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000">
<div style="background:#fff;margin:3% auto;padding:20px;max-width:700px;border-radius:8px;max-height:90%;overflow-y:auto">
<h3> Lift Documents & Manuals</h3>
<div id="documentsContent"></div>
<button onclick="closeDocumentsModal()" class="btn-secondary" style="margin-top:15px">Close</button>
</div>
</div>

<!-- Firebase CDN (compat version for plain HTML) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
//  Firebase Init 
const firebaseConfig = {
  apiKey: "AIzaSyALb27lgPE9MQGD-_9mOb51BXIzqJailno",
  authDomain: "econo-home-lifts-crm.firebaseapp.com",
  projectId: "econo-home-lifts-crm",
  storageBucket: "econo-home-lifts-crm.firebasestorage.app",
  messagingSenderId: "396661053538",
  appId: "1:396661053538:web:9b5e93165394937cb9993b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

//  Firestore helpers 
// All app data lives in a single Firestore document: crm/data
const DATA_REF = db.collection('crm').doc('data');

async function saveToFirebase(dataObj) {
  try {
    await DATA_REF.set(dataObj, { merge: true });
  } catch(e) {
    console.error('Firebase save error:', e);
    alert(' Could not save to cloud. Check internet connection.');
  }
}

async function loadFromFirebase() {
  try {
    const snap = await DATA_REF.get();
    return snap.exists ? snap.data() : null;
  } catch(e) {
    console.error('Firebase load error:', e);
    return null;
  }
}

// Real-time listener  updates all phones instantly when data changes
function startRealtimeSync() {
  DATA_REF.onSnapshot((snap) => {
    if (!snap.exists) return;
    const d = snap.data();
    if (d.admins)          admins          = d.admins;
    if (d.lifts)           lifts           = d.lifts;
    if (d.techs)           techs           = d.techs;
    if (d.tickets)         tickets         = d.tickets;
    if (d.inspections)     inspections     = d.inspections;
    if (d.liftDocuments)   liftDocuments   = d.liftDocuments;
    if (d.whatsappSettings) whatsappSettings = d.whatsappSettings;
    if (d.techLocations)   techLocations   = d.techLocations;
    // Re-render whatever view is active
    if (currentAdmin) {
      renderAdmin();
      checkReminders();
      checkFaulty();
      checkIncomplete();
    }
    if (currentTech) renderTech();
  }, (err) => {
    console.error('Realtime sync error:', err);
  });
}

// Loading Indicator Functions
function showLoader(message = 'Processing...') {
  const overlay = document.getElementById('loadingOverlay');
  const text = overlay.querySelector('.spinner-text');
  if (text) text.textContent = message;
  overlay.classList.add('active');
}

function hideLoader() {
  const overlay = document.getElementById('loadingOverlay');
  overlay.classList.remove('active');
}

// Auto-hide loader after max time (safety)
function showLoaderWithTimeout(message = 'Processing...', maxTime = 10000) {
  showLoader(message);
  setTimeout(() => hideLoader(), maxTime);
}

// In-memory data (synced from Firebase)
let admins=[{username:"admin",pass:"admin123",name:"Main Admin"}];
let lifts=[];
let techs=[];
let tickets=[];
let inspections=[];
let liftDocuments=[];
let whatsappSettings={language:'en',businessNumber:'',apiKey:'',quickReplies:[]};
let techLocations={};
let currentTech="";
let currentAdmin="";
let currentTicketIndex=-1;
let editingLiftIndex=-1;
let editingTicketIndex=-1;
let reportingFaultLiftIndex=-1;
let currentDocumentLiftId="";
let locationUpdateInterval=null; // For periodic location updates

function save(){
  // Save all data to Firebase (syncs to all phones automatically)
  saveToFirebase({
    admins,
    lifts,
    techs,
    tickets,
    inspections,
    liftDocuments,
    whatsappSettings,
    techLocations
  });
  // Keep rememberedUser in localStorage (device-specific login preference)
}

// refreshData is handled automatically by Firebase realtime listener (startRealtimeSync)
// This stub is kept so existing calls don't break
function refreshData(){
  // No-op: data is kept fresh by onSnapshot listener
}

function initializeDemoData(){
  techs=[
    {name:"John",username:"john",pass:"tech1"},
    {name:"Sarah",username:"sarah",pass:"tech2"},
    {name:"Ivan Uys",username:"ivan",pass:"1986"}
  ];
  lifts=[
    {client:"Paul Tru",address:"Rooirevierrif George Western Cape",phone:"",lift:"EHL-D1/03",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Jack Fourie",address:"Meyer Street Wilderness Western Cape",phone:"044 874 6174",lift:"EHL-F1/03",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Huis JJ Watsons",address:"Corner of Cradock & Fichat Street George South GEORGE Western Cape",phone:"044 874 3039/3166",lift:"EHL-S1/2003",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"G.A.F- Silvia Sell",address:"705 Lake Road Wilderness Western Cape",phone:"044 877 1370",lift:"EHL-D1/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"D. Pretorius",address:"Somerset-West Western Cape",phone:"",lift:"EHL-D2/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Rolf Burkhalter",address:"Hibiskus Street Kleinkrantz Western Cape",phone:"044 882 1143",lift:"EHL-D3/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Dr. Eugene van Wyk",address:"7 Uys Street Jeffereys Bay Eastern Cape",phone:"042 293 1956",lift:"EHL-L1/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Herkie Sandenbergh",address:"Oribie Laan 9 Rheebok Kleinbrakrivier Western Cape",phone:"044 969 5967",lift:"EHL-L2/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Dr. Dave & Sue Barnes",address:"2 Motmar Bowtie Drive Plettenberg Bay Western Cape",phone:"044 533 0934",lift:"EHL-L3/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Van Rooyen",address:"Blue Waters Bay P.E. Eastern Cape",phone:"",lift:"EHL-S1/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Van Rooyen",address:"Blue Waters Bay P.E. Eastern Cape",phone:"",lift:"EHL-S2/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Marie- James",address:"Blue Horizen Bay P.E Eastern Cape",phone:"041 453 2272",lift:"EHL-W1/04",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"P.S. Mynhardt",address:"122 Hill Street 144 Holland Grove View KEURBOOM STRAND SINGAPORE",phone:"044 535 9192/65-64636080",lift:"EHL-F1/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"J.M. Geldenhuys",address:"Site 1182 P.O. Box 20001 Ocean Side West Acres",phone:"013 741 2159",lift:"EHL-L1/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Louwtjie Steyn",address:"Site 5527 P.O. Box 6172 First Avenue 162 Kroonheuwel",phone:"056 215 1798",lift:"EHL-L2/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Eduard & Sanmari Ras- Dot Brink",address:"Site 1250 P.O. Box 47 The Tops WILDERNESS",phone:"044 877 0187",lift:"EHL-L3/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Mr. G.J. --Gert Jacobus Du Plessis",address:"Site 7559 P.O. Box 10786 Protea Street 76 DANABAY",phone:"044 698 2127",lift:"EHL-L3/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Mr. David & Cathy Hodgsin",address:"Site 1060 P.O. Box 262 35 Eddystone Drive Riverclub",phone:"044 533 6867/ 011 853 0625",lift:"EHL-L4/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"C.J. Moray-Sutor",address:"49 Coney Glen Road P.O. Box 1361 The Heads KNYSNA",phone:"044 384 0356",lift:"EHL-P1/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Juanita Van Wyk",address:"RLR Centre P.O. Box 892 21 Delafontien Street GEORGE",phone:"044 874 7494",lift:"EHL-S1/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Mr. P. Van den Bank- Amelia",address:"Belfast P.O. Box 269 PRETORIA Belfast",phone:"013 253 1051",lift:"EHL-W1/06",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Mr. Wilfried Kambeck",address:"69 Beachy Head Drive Bella Vista Keurhof PLETTENBERG BAY",phone:"044 533 0083",lift:"EHL-F1/05",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Watson's Baconeries --Andrew, Hendrik",address:"22 Cradock Street George-South",phone:"044 873 5015",lift:"EHL-G1/05",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"Hendrik Aucamp",address:"19 Skuinsbank Street P.O. Box 9194 HEROLDS BAY GEORGE",phone:"",lift:"EHL-L1/05",frequency:6,lastService:Date.now(),isFaulty:false},
    {client:"C.F. --Chris & Ina- Heyens",address:"32 Buitekant Street STILBAY",phone:"028 754 2336",lift:"EHL-L2/05",frequency:6,lastService:Date.now(),isFaulty:false}
  ];
  tickets=[];
  save(); // saves to Firebase
  alert('App initialized! Please log in with credentials provided by your administrator.\n\nIMPORTANT: Change default passwords after first login via Settings.');
}

function resetData(){
  if(confirm(' This will DELETE ALL DATA and reset to demo data.\n\nAre you absolutely sure?')){
    localStorage.removeItem('rememberedUser');
    initializeDemoData();
    location.reload();
  }
}

function login(){
  showLoader('Logging in...');

  // Use setTimeout to allow loader to show
  setTimeout(() => {
    // Always refresh data from localStorage before login to pick up any changes from admin
    refreshData();

    let type=document.getElementById('loginType').value;
    let username=document.getElementById('username').value.trim().toLowerCase();
    let pass=document.getElementById('password').value.trim();
    let rememberMe=document.getElementById('rememberMe').checked;
    let msg=document.getElementById('msg');

    msg.innerText='';
    
    if(!username){
      msg.innerText="Please enter a username";
      hideLoader();
      return;
    }
    
    if(!pass){
      msg.innerText="Please enter a password";
      hideLoader();
      return;
    }
    
    if(type==="admin"){
      let admin=admins.find(a=>a.username.toLowerCase()===username && a.pass===pass);
      if(admin){
        currentAdmin=admin.username;
        if(rememberMe){
          localStorage.setItem('rememberedUser',JSON.stringify({type:'admin',username:admin.username,pass:pass}));
        }
        loginBox.style.display='none';
        adminApp.style.display='block';
        document.getElementById('adminLoggedInName').innerText=admin.name||admin.username;
        renderAdmin();
        checkReminders();
        checkFaulty();
        checkIncomplete();
        renderInspections();
        hideLoader();
      } else {
        msg.innerText="Wrong admin username or password";
        hideLoader();
      }
    }
  else if(type==="tech"){
    if(techs.length===0){
      msg.innerText="No technicians found! Please reset data or add techs via admin.";
      hideLoader();
      return;
    }
    // Compare with lowercase for case-insensitive match
    let t=techs.find(x=>x.username.toLowerCase()===username && x.pass===pass);
    if(t){
      currentTech=t.name;
      if(rememberMe){
        localStorage.setItem('rememberedUser',JSON.stringify({type:'tech',username:username,pass:pass,name:t.name}));
      }
      loginBox.style.display='none';
      techApp.style.display='block';
      document.getElementById('techTitle').innerText=`Welcome, ${currentTech}!`;
      renderTech();
      
      // Start GPS location tracking for technician
      startLocationTracking();
      
      hideLoader();
    } else {
      msg.innerText="Wrong username or password";
      hideLoader();
    }
  }
  }, 100); // Small delay to show loader
}

function updateLoginPlaceholders(){
  let type=document.getElementById('loginType').value;
  let usernameField=document.getElementById('username');
  
  if(type==="admin"){
    usernameField.placeholder="Username (e.g., admin)";
  } else {
    usernameField.placeholder="Username (e.g., john, sarah)";
  }
}

// GPS Location Tracking Functions
function startLocationTracking(){
  if(!currentTech) return;
  
  // Request location permission
  if('geolocation' in navigator){
    navigator.geolocation.getCurrentPosition(
      (position)=>{
        updateTechLocation(position.coords.latitude, position.coords.longitude);
        
        // Update location every 5 minutes
        locationUpdateInterval=setInterval(()=>{
          navigator.geolocation.getCurrentPosition(
            (pos)=>{
              updateTechLocation(pos.coords.latitude, pos.coords.longitude);
            },
            (error)=>{
              console.log('Location update failed:', error.message);
            }
          );
        }, 300000); // 5 minutes
      },
      (error)=>{
        console.log('Location permission denied or unavailable');
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  }
}

function stopLocationTracking(){
  if(locationUpdateInterval){
    clearInterval(locationUpdateInterval);
    locationUpdateInterval=null;
  }
}

function updateTechLocation(lat, lng){
  if(!currentTech) return;
  
  techLocations[currentTech]={
    latitude: lat,
    longitude: lng,
    timestamp: new Date().toISOString(),
    accuracy: 'GPS'
  };
  
  save();
}

function renderTechTracking(){
  let trackingDiv=document.getElementById('tech-tracking-content');
  if(!trackingDiv) return;
  
  let html='<h3> Technician Locations</h3>';
  html+='<p style="font-size:13px;color:var(--text-muted);margin-bottom:20px">Real-time GPS tracking of your field technicians</p>';
  
  if(Object.keys(techLocations).length===0){
    html+='<div class="card"><p style="text-align:center;color:var(--text-muted);padding:40px">No technicians are currently sharing their location.<br><br>Location tracking starts when technicians login on their mobile devices.</p></div>';
    trackingDiv.innerHTML=html;
    return;
  }
  
  // Show each tech's location
  Object.keys(techLocations).forEach(techName=>{
    let loc=techLocations[techName];
    let tech=techs.find(t=>t.name===techName);
    if(!tech) return;
    
    let timeAgo=getTimeAgo(new Date(loc.timestamp));
    let mapsUrl=`https://www.google.com/maps?q=${loc.latitude},${loc.longitude}`;
    
    // Find current job for this tech
    let currentJob=tickets.find(t=>
      t.tech===techName &&
      (t.status==='Open' || t.status==='In Progress') &&
      t.scheduledDate===new Date().toISOString().split('T')[0]
    );
    
    html+=`
      <div class="card" style="margin-bottom:15px">
        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">
          <div>
            <h4 style="margin:0;color:var(--text-primary)"> ${techName}</h4>
            <p style="margin:4px 0;font-size:12px;color:var(--text-muted)">
               Last updated: ${timeAgo}
            </p>
          </div>
          <div style="text-align:right">
            <span style="background:var(--accent-primary);color:#fff;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600">
              ACTIVE
            </span>
          </div>
        </div>
        
        ${currentJob ? `
          <div style="background:var(--bg-secondary);padding:12px;border-radius:6px;margin-bottom:12px">
            <p style="margin:0;font-size:13px;color:var(--text-primary)">
              <strong>Current Job:</strong><br>
               ${currentJob.lift.client}<br>
               ${currentJob.lift.address}<br>
               ${currentJob.ticketNumber}
            </p>
          </div>
        ` : `
          <div style="background:var(--bg-secondary);padding:12px;border-radius:6px;margin-bottom:12px">
            <p style="margin:0;font-size:13px;color:var(--text-muted)">
              No active job scheduled for today
            </p>
          </div>
        `}
        
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <a href="${mapsUrl}" target="_blank" class="btn-small" style="background:var(--accent-primary);color:#fff;text-decoration:none;display:inline-block">
             View on Google Maps
          </a>
          <button onclick="getDirectionsToTech('${techName}')" class="btn-small" style="background:var(--accent-secondary);color:#fff">
             Get Directions
          </button>
          <button onclick="callTech('${tech.username}')" class="btn-small" style="background:#10b981;color:#fff">
             Call Tech
          </button>
        </div>
        
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border-color)">
          <p style="margin:0;font-size:11px;color:var(--text-muted)">
             Coordinates: ${loc.latitude.toFixed(6)}, ${loc.longitude.toFixed(6)}
          </p>
        </div>
      </div>
    `;
  });
  
  trackingDiv.innerHTML=html;
}

function getDirectionsToTech(techName){
  let loc=techLocations[techName];
  if(!loc){
    alert('Location not available for this technician');
    return;
  }
  
  let url=`https://www.google.com/maps/dir/?api=1&destination=${loc.latitude},${loc.longitude}`;
  window.open(url, '_blank');
}

function callTech(username){
  let tech=techs.find(t=>t.username===username);
  if(!tech || !tech.phone){
    alert('Phone number not available for this technician.\n\nAdd phone number in Tech management.');
    return;
  }
  
  window.open(`tel:${tech.phone}`);
}

function logout(){
  if(confirm('Are you sure you want to logout? (This will also clear "Remember Me")')){
    // Stop location tracking for technicians
    stopLocationTracking();
    
    localStorage.removeItem('rememberedUser');
    location.reload();
  }
}

function showTab(tab,ev){
  document.querySelectorAll('#adminApp .tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('#adminApp .tab-content').forEach(c=>c.classList.remove('active'));
  let btn=ev?ev.target:document.querySelector('#adminApp .tab[onclick*=\"'+tab+'\"]');
  if(btn) btn.classList.add('active');
  document.getElementById(tab+'-tab').classList.add('active');
  
  // Render content for specific tabs
  if(tab==='reports') generateReport();
  if(tab==='faults') renderFaults();
  if(tab==='dashboard') renderDashboard();
  if(tab==='kanban') renderKanban();
  if(tab==='calendar') renderCalendar();
  if(tab==='tracking') renderTechTracking();
  if(tab==='lifts') renderAdmin();
}

function showTechTab(tab,ev){
  document.querySelectorAll('#techApp .tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('#techApp .tab-content').forEach(c=>c.classList.remove('active'));
  let btn=ev?ev.target:document.querySelector('#techApp .tab[onclick*=\"'+tab+'\"]');
  if(btn) btn.classList.add('active');
  document.getElementById(tab+'-tab').classList.add('active');
}

function addLift(){
  let client=document.getElementById('client').value;
  let address=document.getElementById('clientAddress').value;
  let phone=document.getElementById('clientPhone').value;
  let lift=document.getElementById('lift').value;
  let frequency=parseInt(document.getElementById('frequency').value);
  
  if(!client||!address||!lift){
    alert('Please fill in client, address, and lift ID');
    return;
  }
  if(isNaN(frequency) || frequency<=0){
    alert('Please enter a valid service frequency (in months)');
    return;
  }
  
  showLoader('Adding lift...');
  
  setTimeout(() => {
    lifts.push({
      client,
      address,
      phone,
      lift,
      frequency,
      lastService:Date.now(),
      isFaulty:false
    });
    
    save();
    renderAdmin();
    hideLoader();
    
    document.getElementById('client').value='';
  document.getElementById('clientAddress').value='';
  document.getElementById('clientPhone').value='';
  document.getElementById('lift').value='';
  alert('Lift added successfully!');
  }, 100);
}

function importCSV(){
  let fileInput=document.getElementById('csvFileInput');
  let file=fileInput.files[0];
  
  if(!file){
    alert('Please select a CSV file first');
    return;
  }
  
  let reader=new FileReader();
  reader.onload=function(e){
    let text=e.target.result;
    let lines=text.split('\n');
    let imported=0;
    let skipped=0;
    
    // Skip header row (line 0)
    for(let i=1;i<lines.length;i++){
      let line=lines[i].trim();
      if(!line) continue;
      
      // Parse CSV line (handle commas in quotes)
      let cols=parseCSVLine(line);
      
      if(cols.length<5) continue;
      
      let client=cols[0].trim();
      let address=cols[1].trim();
      let phone=cols[2].trim();
      let liftId=cols[3].trim();
      let frequency=cols[4].trim();
      
      // Skip if client or lift ID is empty
      if(!client||!liftId){
        skipped++;
        continue;
      }
      
      // Check if lift already exists
      let exists=lifts.find(l=>l.lift===liftId);
      if(exists){
        skipped++;
        continue;
      }
      
      // Default frequency to 6 months if not specified or invalid
      let freq=6;
      if(frequency){
        let parsed=parseInt(frequency);
        if(!isNaN(parsed) && [1,3,6,12].includes(parsed)){
          freq=parsed;
        }
      }
      
      lifts.push({
        client:client,
        address:address,
        phone:phone,
        lift:liftId,
        frequency:freq,
        lastService:Date.now(),
        isFaulty:false
      });
      imported++;
    }
    
    save();
    renderAdmin();
    fileInput.value=''; // Clear file input
    alert(`CSV Import Complete!\n\nImported: ${imported} lifts\nSkipped: ${skipped} (duplicates or invalid)`);
  };
  
  reader.readAsText(file);
}

function parseCSVLine(line){
  let cols=[];
  let current='';
  let inQuotes=false;
  
  for(let i=0;i<line.length;i++){
    let char=line[i];
    
    if(char==='"'){
      inQuotes=!inQuotes;
    } else if(char===',' && !inQuotes){
      cols.push(current);
      current='';
    } else {
      current+=char;
    }
  }
  cols.push(current);
  
  return cols;
}


function deleteLift(i){
  if(confirm('Delete this lift?')){
    lifts.splice(i,1);
    save();
    renderAdmin();
  }
}

function openEditLiftModal(i){
  editingLiftIndex=i;
  let l=lifts[i];
  document.getElementById('editLiftClient').value=l.client;
  document.getElementById('editLiftAddress').value=l.address;
  document.getElementById('editLiftPhone').value=l.phone;
  document.getElementById('editLiftId').value=l.lift;
  document.getElementById('editLiftFrequency').value=l.frequency;
  document.getElementById('editLiftModal').style.display='block';
}

function closeEditLiftModal(){
  document.getElementById('editLiftModal').style.display='none';
  editingLiftIndex=-1;
}

function updateLift(){
  if(editingLiftIndex===-1) return;
  let newFreq=parseInt(document.getElementById('editLiftFrequency').value);
  if(isNaN(newFreq) || newFreq<=0){
    alert('Please enter a valid service frequency (in months)');
    return;
  }
  lifts[editingLiftIndex].client=document.getElementById('editLiftClient').value;
  lifts[editingLiftIndex].address=document.getElementById('editLiftAddress').value;
  lifts[editingLiftIndex].phone=document.getElementById('editLiftPhone').value;
  lifts[editingLiftIndex].lift=document.getElementById('editLiftId').value;
  lifts[editingLiftIndex].frequency=newFreq;
  save();
  renderAdmin();
  closeEditLiftModal();
  alert('Lift updated!');
}

function addTech(){
  let name=document.getElementById('techName').value.trim();
  let username=document.getElementById('techUsername').value.trim().toLowerCase();
  let pass=document.getElementById('techPass').value.trim();
  
  // Better validation with specific messages
  if(!name){
    alert(' Please enter technician name\n\nExample: John Smith');
    document.getElementById('techName').focus();
    return;
  }
  
  if(!username){
    alert(' Please enter username\n\nExample: john\n\n Must be lowercase, no spaces');
    document.getElementById('techUsername').focus();
    return;
  }
  
  if(!pass){
    alert(' Please enter password\n\nMinimum 4 characters recommended');
    document.getElementById('techPass').focus();
    return;
  }
  
  // Check for duplicate username
  if(techs.find(t=>t.username.toLowerCase()===username)){
    alert(` Username "${username}" already exists!\n\nPlease choose a different username.\n\nExisting usernames:\n${techs.map(t=>t.username).join(', ')}`);
    document.getElementById('techUsername').focus();
    return;
  }
  
  // Validate username format (no spaces, alphanumeric)
  if(!/^[a-z0-9_]+$/.test(username)){
    alert(' Username can only contain:\n\n Lowercase letters (a-z)\n Numbers (0-9)\n Underscores (_)\n\nNo spaces or special characters allowed.');
    document.getElementById('techUsername').focus();
    return;
  }
  
  // Show loader
  showLoader('Adding technician...');
  
  setTimeout(() => {
    // Add technician
    techs.push({
      name: name,
      username: username,
      pass: pass
    });
    
    save();
    renderAdmin();
    
    // Clear form
    document.getElementById('techName').value='';
    document.getElementById('techUsername').value='';
    document.getElementById('techPass').value='';
    
    hideLoader();
    
    // Success message with credentials
    alert(` Technician added successfully!\n\n Name: ${name}\n Username: ${username}\n Password: ${pass}\n\n Save these credentials!\nThe technician will need them to login.`);
    
    // Focus back to name field for next entry
    document.getElementById('techName').focus();
  }, 100);
}

function deleteTech(i){
  if(confirm('Delete this technician?')){
    techs.splice(i,1);
    save();
    renderAdmin();
  }
}

function createTicket(){
  let liftIdx=parseInt(document.getElementById('ticketLift').value);
  let techIdx=parseInt(document.getElementById('ticketTech').value);
  let jobType=document.getElementById('ticketType').value;
  let scheduledDate=document.getElementById('ticketDate').value;
  let note=document.getElementById('ticketNote').value;
  let photoFiles=document.getElementById('ticketPhotos').files;
  
  if(isNaN(liftIdx)||isNaN(techIdx)||!scheduledDate){
    alert('Please fill all required fields');
    return;
  }
  
  let ticketNumber=getNextTicketNumber();
  
  // Convert photos to base64
  let photos=[];
  let processPhotos=Array.from(photoFiles).map(file=>{
    return new Promise((resolve)=>{
      let reader=new FileReader();
      reader.onload=function(e){
        photos.push({data:e.target.result,name:file.name,date:new Date().toISOString()});
        resolve();
      };
      reader.readAsDataURL(file);
    });
  });
  
  Promise.all(processPhotos).then(()=>{
    let isFaulty=jobType==='Faulty';

    // Mark lift as faulty if this is a fault ticket
    if(isFaulty){
      lifts[liftIdx].isFaulty=true;
    }

    tickets.push({
      ticketNumber,
      lift:lifts[liftIdx],
      tech:techs[techIdx]?.name||'',
      jobType,
      scheduledDate,
      note,
      status:'Open',
      notes:[],
      photos:photos,
      created:new Date().toISOString(),
      isFaulty:isFaulty,
      isIncomplete:false,
      priority:isFaulty?'Normal':undefined
    });

    save();
    renderAdmin();

    // Update faults tab if this is a fault ticket
    if(isFaulty && document.getElementById('faults-tab')){
      renderFaults();
    }

    document.getElementById('ticketLift').value='';
    document.getElementById('ticketTech').value='';
    document.getElementById('ticketDate').value='';
    document.getElementById('ticketNote').value='';
    document.getElementById('ticketPhotos').value='';
    alert('Ticket created: '+ticketNumber);
  });
}

function deleteTicket(i){
  if(confirm('Delete this ticket?')){
    tickets.splice(i,1);
    save();
    renderAdmin();
    renderTech();
  }
}

function openEditTicketModal(i){
  editingTicketIndex=i;
  let t=tickets[i];
  
  populateTicketDropdowns('editTicketLift','editTicketTech');
  
  let liftIdx=lifts.findIndex(l=>l.lift===t.lift.lift);
  document.getElementById('editTicketLift').value=liftIdx;
  document.getElementById('editTicketTech').value=techs.findIndex(x=>x.name===t.tech);
  document.getElementById('editTicketType').value=t.jobType||'Service';
  document.getElementById('editTicketDate').value=t.scheduledDate;
  document.getElementById('editTicketNote').value=t.note||'';
  document.getElementById('editTicketStatus').value=t.status;
  document.getElementById('editTicketModal').style.display='block';
}

function closeEditTicketModal(){
  document.getElementById('editTicketModal').style.display='none';
  editingTicketIndex=-1;
}

function updateTicket(){
  if(editingTicketIndex===-1) return;
  let liftIdx=parseInt(document.getElementById('editTicketLift').value);
  tickets[editingTicketIndex].lift=lifts[liftIdx];
  let editTechIdx=parseInt(document.getElementById('editTicketTech').value);
  tickets[editingTicketIndex].tech=techs[editTechIdx]?.name||'';
  tickets[editingTicketIndex].jobType=document.getElementById('editTicketType').value;
  tickets[editingTicketIndex].scheduledDate=document.getElementById('editTicketDate').value;
  tickets[editingTicketIndex].note=document.getElementById('editTicketNote').value;
  tickets[editingTicketIndex].status=document.getElementById('editTicketStatus').value;
  save();
  renderAdmin();
  renderTech();
  closeEditTicketModal();
  alert('Ticket updated!');
}

function openFaultReportModal(liftIdx){
  reportingFaultLiftIndex=liftIdx;
  let lift=lifts[liftIdx];
  
  // Display lift info
  document.getElementById('faultLiftInfo').innerHTML=`
     ${lift.client}<br>
     Lift: ${lift.lift}<br>
     ${lift.address}
  `;
  
  // Populate technician dropdown
  let techSelect=document.getElementById('faultTechSelect');
  techSelect.innerHTML='<option value="">Select Technician</option>';
  techs.forEach((t,i)=>{
    techSelect.innerHTML+=`<option value="${i}">${t.name}</option>`;
  });
  
  // Clear fields
  document.getElementById('faultDescription').value='';
  document.getElementById('faultPriority').value='Normal';
  
  // Show modal
  document.getElementById('faultReportModal').style.display='block';
}

function closeFaultReportModal(){
  document.getElementById('faultReportModal').style.display='none';
  reportingFaultLiftIndex=-1;
}

function openTechFaultReport(){
  let liftIdx=parseInt(document.getElementById('techFaultLiftSelect').value);
  if(isNaN(liftIdx)){
    alert('Please select a lift first');
    return;
  }
  openFaultReportModal(liftIdx);
}

function submitFaultReport(){
  if(reportingFaultLiftIndex===-1) return;
  
  let techIdx=parseInt(document.getElementById('faultTechSelect').value);
  let description=document.getElementById('faultDescription').value.trim();
  let priority=document.getElementById('faultPriority').value;
  
  if(isNaN(techIdx)){
    alert('Please select a technician');
    return;
  }
  
  if(!description){
    alert('Please describe the fault');
    return;
  }
  
  let lift=lifts[reportingFaultLiftIndex];
  let today=new Date().toISOString().split('T')[0];
  let ticketNumber=getNextTicketNumber();
  
  // Mark lift as faulty
  lifts[reportingFaultLiftIndex].isFaulty=true;
  
  // Create urgent fault ticket
  tickets.push({
    ticketNumber,
    lift:lift,
    tech:techs[techIdx]?.name||'',
    jobType:'Faulty',
    scheduledDate:today,
    note:` PRIORITY: ${priority}\n\n${description}`,
    status:'Open',
    notes:[],
    created:new Date().toISOString(),
    isFaulty:true,
    isIncomplete:false,
    priority:priority
  });
  
  save();
  renderAdmin();

  // Update tech view so the new fault ticket appears immediately
  if(currentTech) renderTech();

  // Render faults tab to update counts
  if(document.getElementById('faults-tab')){
    renderFaults();
  }
  
  closeFaultReportModal();
  
  alert(`Fault ticket ${ticketNumber} created!\n\nPriority: ${priority}\nAssigned to: ${techs[techIdx].name}`);
}

function getNextTicketNumber(){
  let maxNum=0;
  tickets.forEach(t=>{
    let num=parseInt(t.ticketNumber.replace('T',''));
    if(!isNaN(num) && num>maxNum) maxNum=num;
  });
  return 'T'+(maxNum+1).toString().padStart(4,'0');
}

function populateTicketDropdowns(liftSelectId,techSelectId){
  let liftSelect=document.getElementById(liftSelectId);
  let techSelect=document.getElementById(techSelectId);
  
  liftSelect.innerHTML='<option value="">Select Lift</option>';
  lifts.forEach((l,i)=>{
    liftSelect.innerHTML+=`<option value="${i}">${l.client} - ${l.lift}</option>`;
  });
  
  techSelect.innerHTML='<option value="">Select Technician</option>';
  techs.forEach((t,i)=>{
    techSelect.innerHTML+=`<option value="${i}">${t.name}</option>`;
  });
}

// Performance optimization - debounced rendering
let renderTimeout;
function debouncedRender(func, delay = 100) {
  clearTimeout(renderTimeout);
  renderTimeout = setTimeout(func, delay);
}

function renderAdmin(){
  // Lifts Table - use document fragment for better performance
  let liftTable=document.getElementById('liftTable');
  if(!liftTable) return;
  
  function escAttr(s){return String(s).replace(/&/g,'&amp;').replace(/'/g,'&#39;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

  let rows = [];
  lifts.forEach((l,i)=>{
    let daysSince=Math.floor((Date.now()-l.lastService)/(1000*60*60*24));
    let dueIn=l.frequency*30-daysSince;
    let status=dueIn<0?' OVERDUE':(dueIn<7?' Due Soon':' OK');
    let statusClass=dueIn<0?'status-overdue':'';
    let faultyBadge=l.isFaulty?'<span style="background:#ff6b6b;color:#fff;padding:2px 6px;border-radius:4px;font-size:11px">FAULTY</span>':'';

    rows.push(`<tr class="${statusClass}">
        <td>${escAttr(l.client)}</td>
        <td>${escAttr(l.address)}</td>
        <td>${escAttr(l.phone)}</td>
        <td>${escAttr(l.lift)} ${faultyBadge}</td>
        <td>${l.frequency} month(s)</td>
        <td>${status} (${dueIn} days)</td>
        <td><button onclick="viewLiftHistory('${escAttr(l.lift)}')" class="btn-small" style="background:#17a2b8;color:#fff"> History</button></td>
        <td><button onclick="openDocumentsModal('${escAttr(l.lift)}')" class="btn-small" style="background:#6f42c1;color:#fff"> Docs</button></td>
        <td><button onclick="sendServiceReminder('${escAttr(l.phone)}','${escAttr(l.client)}','${escAttr(l.lift)}','${escAttr(l.address)}')" class="btn-small btn-warning">Send Reminder</button></td>
        <td><button onclick="openFaultReportModal(${i})" class="btn-small btn-danger"> Report Fault</button></td>
        <td><a href="https://wa.me/${encodeURIComponent(l.phone)}" target="_blank" class="btn-small" style="background:#25d366;color:#fff;text-decoration:none;display:inline-block;padding:8px;border-radius:4px;font-size:12px">WhatsApp</a></td>
        <td>
          <button onclick="openEditLiftModal(${i})" class="btn-small btn-secondary">Edit</button>
          <button onclick="deleteLift(${i})" class="btn-small btn-danger">Delete</button>
        </td>
      </tr>`);
  });

  liftTable.innerHTML = rows.join('');
  
  // Techs Table
  let techTable=document.getElementById('techTable');
  if(techTable){
    let techRows = [];
    techs.forEach((t,i)=>{
      let username=t.username||'N/A';
      techRows.push(`<tr>
          <td>${escAttr(t.name)}</td>
          <td>${escAttr(username)}</td>
          <td>********</td>
          <td><button onclick="deleteTech(${i})" class="btn-small btn-danger">Delete</button></td>
        </tr>`);
    });
    techTable.innerHTML = techRows.join('');
  }
  
  // Admins Table
  let adminTable=document.getElementById('adminTable');
  if(adminTable){
    let adminRows = [];
    admins.forEach((a,i)=>{
      adminRows.push(`<tr>
          <td>${escAttr(a.name||'N/A')}</td>
          <td>${escAttr(a.username)}</td>
          <td>********</td>
          <td><button onclick="deleteAdmin(${i})" class="btn-small btn-danger" ${admins.length===1?'disabled':''}>Delete</button></td>
        </tr>`);
    });
    adminTable.innerHTML = adminRows.join('');
  }
  
  // Admin Ticket Table
  let adminTicketTable=document.getElementById('adminTicketTable');
  if(!adminTicketTable) return;
  adminTicketTable.innerHTML='';
  tickets.forEach((t,i)=>{
    let statusClass=t.status==='Done'?'status-done':(t.scheduledDate<new Date().toISOString().split('T')[0]?'status-overdue':'status-open');
    let faultyBadge=t.isFaulty?'<span style="background:#ff6b6b;color:#fff;padding:2px 6px;border-radius:4px;font-size:11px">FAULTY</span>':'';
    let incompleteBadge=t.isIncomplete?'<span style="background:#ffa726;color:#000;padding:2px 6px;border-radius:4px;font-size:11px">INCOMPLETE</span>':'';
    let jobType=t.jobType||'Service';
    
    adminTicketTable.innerHTML+=`
      <tr class="${statusClass}">
        <td>${t.ticketNumber}</td>
        <td>${t.lift.client}</td>
        <td>${t.lift.lift} ${faultyBadge} ${incompleteBadge}</td>
        <td>${t.lift.address}</td>
        <td>${jobType}</td>
        <td>${t.tech||'N/A'}</td>
        <td>${t.scheduledDate}</td>
        <td>${t.status}</td>
        <td><button onclick="openMap('${t.lift.address}')" class="btn-small"> Map</button></td>
        <td>
          <button onclick="openEditTicketModal(${i})" class="btn-small btn-secondary">Edit</button>
          <button onclick="deleteTicket(${i})" class="btn-small btn-danger">Delete</button>
        </td>
      </tr>
    `;
  });
  
  populateTicketDropdowns('ticketLift','ticketTech');
  checkReminders();
  checkFaulty();
  checkIncomplete();
}

function checkReminders(){
  let reminderList=document.getElementById('reminderList');
  if(!reminderList) return;
  
  let count=0;
  reminderList.innerHTML='';
  
  lifts.forEach((l,i)=>{
    let daysSince=Math.floor((Date.now()-l.lastService)/(1000*60*60*24));
    let dueIn=l.frequency*30-daysSince;
    
    if(dueIn<=7 && dueIn>=-30){
      count++;
      let urgency=dueIn<0?' OVERDUE':' Due Soon';
      reminderList.innerHTML+=`
        <div class="card" style="border-left:4px solid ${dueIn<0?'#dc3545':'#ffc107'}">
          <strong>${l.client} - ${l.lift}</strong><br>
          <span style="font-size:13px;color:#666">${l.address}</span><br>
          <span style="font-weight:bold;color:${dueIn<0?'#dc3545':'#856404'}">${urgency} (${dueIn} days)</span><br>
          <button onclick="sendServiceReminder('${l.phone}','${l.client}','${l.lift}','${l.address}')" class="btn-small btn-warning" style="margin-top:8px"> Send WhatsApp Reminder</button>
        </div>
      `;
    }
  });
  
  if(count===0){
    reminderList.innerHTML='<p style="color:#999;text-align:center">No maintenance reminders at this time</p>';
  }
  
  let badge=document.getElementById('reminderCount');
  if(badge){
    if(count>0){
      badge.innerText=count;
      badge.style.display='inline-block';
    } else {
      badge.style.display='none';
    }
  }
}

function checkFaulty(){
  let faultyList=document.getElementById('faultyList');
  if(!faultyList) return;
  
  let faultyLifts=lifts.filter(l=>l.isFaulty);
  let count=faultyLifts.length;
  
  faultyList.innerHTML='';
  faultyLifts.forEach(l=>{
    faultyList.innerHTML+=`
      <div class="card status-faulty">
        <strong>${l.client} - ${l.lift}</strong><br>
        <span style="font-size:13px">${l.address}</span><br>
        <span style="font-size:13px">Phone: ${l.phone}</span>
      </div>
    `;
  });
  
  if(count===0){
    faultyList.innerHTML='<p style="color:#999;text-align:center">No faulty lifts reported</p>';
  }
  
  let badge=document.getElementById('faultyCount');
  if(badge){
    if(count>0){
      badge.innerText=count;
      badge.style.display='inline-block';
    } else {
      badge.style.display='none';
    }
  }
}

function checkIncomplete(){
  let incompleteList=document.getElementById('incompleteList');
  if(!incompleteList) return;
  
  let incompleteTickets=tickets.filter(t=>t.isIncomplete && t.status==='Open');
  let count=incompleteTickets.length;
  
  incompleteList.innerHTML='';
  incompleteTickets.forEach(t=>{
    incompleteList.innerHTML+=`
      <div class="card status-incomplete">
        <strong>Ticket: ${t.ticketNumber}</strong><br>
        <strong>${t.lift.client} - ${t.lift.lift}</strong><br>
        <span style="font-size:13px">${t.lift.address}</span><br>
        <span style="font-size:13px">Scheduled: ${t.scheduledDate}</span><br>
        <span style="font-size:13px">Tech: ${t.tech||'N/A'}</span>
      </div>
    `;
  });
  
  if(count===0){
    incompleteList.innerHTML='<p style="color:#999;text-align:center">No incomplete jobs</p>';
  }
  
  let badge=document.getElementById('incompleteCount');
  if(badge){
    if(count>0){
      badge.innerText=count;
      badge.style.display='inline-block';
    } else {
      badge.style.display='none';
    }
  }
}

function renderTech(){
  if(!currentTech) return;

  let myTickets=tickets.filter(t=>t.tech===currentTech && (t.status==='Open' || t.status==='In Progress'));
  let today=new Date().toISOString().split('T')[0];
  let todayJobs=myTickets.filter(t=>t.scheduledDate===today);
  let allJobs=myTickets.filter(t=>t.scheduledDate!==today);
  let completedJobs=tickets.filter(t=>t.tech===currentTech && t.status==='Done');

  // Today's Jobs
  let techJobsToday=document.getElementById('techJobsToday');
  if(!techJobsToday) return;
  techJobsToday.innerHTML='';
  if(todayJobs.length===0){
    techJobsToday.innerHTML='<p style="color:#999;text-align:center">No jobs scheduled for today</p>';
  } else {
    todayJobs.forEach((t,i)=>{
      let idx=tickets.findIndex(ticket=>ticket.ticketNumber===t.ticketNumber);
      techJobsToday.innerHTML+=renderTicketCard(t,idx);
    });
  }

  // All Open Jobs
  let techJobsAll=document.getElementById('techJobsAll');
  techJobsAll.innerHTML='';
  if(allJobs.length===0){
    techJobsAll.innerHTML='<p style="color:#999;text-align:center">No other jobs scheduled</p>';
  } else {
    allJobs.forEach((t,i)=>{
      let idx=tickets.findIndex(ticket=>ticket.ticketNumber===t.ticketNumber);
      techJobsAll.innerHTML+=renderTicketCard(t,idx);
    });
  }
  
  // Completed Jobs
  let techJobsCompleted=document.getElementById('techJobsCompleted');
  techJobsCompleted.innerHTML='';
  if(completedJobs.length===0){
    techJobsCompleted.innerHTML='<p style="color:#999;text-align:center">No completed jobs yet</p>';
  } else {
    completedJobs.forEach((t,i)=>{
      let completedDate=t.completed?new Date(t.completed).toLocaleDateString():'N/A';
      techJobsCompleted.innerHTML+=`
        <div class="card status-done">
          <div style="background:#28a745;color:#fff;padding:6px;border-radius:4px;margin-bottom:8px;font-weight:bold"> Completed: ${completedDate}</div>
          <strong>${t.lift.client} - ${t.lift.lift}</strong><br>
          <span style="font-size:13px;color:#666"> ${t.lift.address}</span><br>
          <span style="font-size:13px;color:#666">Type: ${t.jobType||'Service'}</span>
        </div>
      `;
    });
  }
  
  // Populate lift dropdown for quick fault reporting
  let techFaultLiftSelect=document.getElementById('techFaultLiftSelect');
  if(techFaultLiftSelect){
    techFaultLiftSelect.innerHTML='<option value="">Select Lift</option>';
    lifts.forEach((l,i)=>{
      techFaultLiftSelect.innerHTML+=`<option value="${i}">${l.client} - ${l.lift}</option>`;
    });
  }
}

function renderTicketCard(t,i){
  // Get all historical notes for this lift from all completed tickets
  let liftHistory=[];
  tickets.forEach(ticket=>{
    if(ticket.lift.lift===t.lift.lift && ticket.status==='Done' && ticket.notes && ticket.notes.length>0){
      ticket.notes.forEach(note=>{
        liftHistory.push({
          ticketNum:ticket.ticketNumber,
          date:ticket.completed,
          jobType:ticket.jobType||'Service',
          tech:note.tech,
          text:note.text,
          time:note.time,
          photos:note.photos||[]
        });
      });
    }
  });
  
  // Sort by date, newest first
  liftHistory.sort((a,b)=>new Date(b.date)-new Date(a.date));
  
  // Build history HTML
  let historyHtml='';
  if(liftHistory.length>0){
    historyHtml='<div style="margin:15px 0;padding:10px;background:#f0f8ff;border-radius:6px;border-left:4px solid #007bff">';
    historyHtml+=`<strong style="color:#007bff"> Lift Service History (${liftHistory.length} previous services)</strong>`;
    historyHtml+=`<div style="max-height:300px;overflow-y:auto;margin-top:10px">`;
    
    liftHistory.forEach(h=>{
      let jobIcon='';
      if(h.jobType==='Faulty') jobIcon='';
      else if(h.jobType==='Upgrade') jobIcon='';
      else if(h.jobType==='New Install') jobIcon='';
      else if(h.jobType==='Inspection') jobIcon='';
      
      historyHtml+=`<div class="note-item" style="background:#fff;margin:5px 0">`;
      historyHtml+=`<div style="font-size:11px;color:#666;margin-bottom:3px">${jobIcon} ${h.jobType} | Ticket: ${h.ticketNum}</div>`;
      historyHtml+=`<strong>${h.tech}:</strong> ${h.text}<br>`;
      historyHtml+=`<span class="note-time">${h.time}</span>`;
      
      if(h.photos && h.photos.length>0){
        historyHtml+=`<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-top:5px">`;
        h.photos.forEach(p=>{
          historyHtml+=`<img src="${p.data}" style="width:100%;height:60px;object-fit:cover;border-radius:4px;cursor:pointer" onclick="window.open('${p.data}','_blank')">`;
        });
        historyHtml+=`</div>`;
      }
      historyHtml+=`</div>`;
    });
    
    historyHtml+=`</div></div>`;
  }
  
  // Current ticket notes (if any, for incomplete tickets)
  let currentNotesHtml='';
  if(t.notes && t.notes.length>0 && (t.status==='Open' || t.status==='In Progress')){
    currentNotesHtml='<div style="margin:10px 0"><strong>Current Ticket Notes:</strong></div><div>';
    t.notes.forEach(n=>{
      currentNotesHtml+=`<div class="note-item"><strong>${n.tech}:</strong> ${n.text}<br><span class="note-time">${n.time}</span>`;
      if(n.photos && n.photos.length>0){
        currentNotesHtml+=`<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-top:5px">`;
        n.photos.forEach(p=>{
          currentNotesHtml+=`<img src="${p.data}" style="width:100%;height:80px;object-fit:cover;border-radius:4px;cursor:pointer" onclick="window.open('${p.data}','_blank')">`;
        });
        currentNotesHtml+=`</div>`;
      }
      currentNotesHtml+=`</div>`;
    });
    currentNotesHtml+='</div>';
  }
  
  // Display initial ticket photos if any
  let ticketPhotosHtml='';
  if(t.photos && t.photos.length>0){
    ticketPhotosHtml='<div style="margin:10px 0"><strong>Attached Photos:</strong></div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-bottom:10px">';
    t.photos.forEach(p=>{
      ticketPhotosHtml+=`<img src="${p.data}" style="width:100%;height:80px;object-fit:cover;border-radius:4px;cursor:pointer" onclick="window.open('${p.data}','_blank')">`;
    });
    ticketPhotosHtml+='</div>';
  }
  
  let inProgressBadge=t.status==='In Progress'?'<div style="background:#ff9800;color:#fff;padding:5px;border-radius:4px;margin:5px 0;font-weight:bold"> IN PROGRESS</div>':'';
  let faultyBadge=t.isFaulty?'<div style="background:#ff6b6b;color:#fff;padding:5px;border-radius:4px;margin:5px 0"> MARKED AS FAULTY</div>':'';
  let overdue=t.scheduledDate<new Date().toISOString().split('T')[0]?'<div style="color:red"> OVERDUE</div>':'';
  
  let jobType=t.jobType||'Service';
  let typeColor='';
  let typeIcon='';
  if(jobType==='Faulty'){ 
    typeColor='background:#ff6b6b;color:#fff';
    typeIcon='';
  } else if(jobType==='Upgrade'){ 
    typeColor='background:#9C27B0;color:#fff';
    typeIcon='';
  } else if(jobType==='New Install'){ 
    typeColor='background:#4CAF50;color:#fff';
    typeIcon='';
  } else if(jobType==='Inspection'){ 
    typeColor='background:#2196F3;color:#fff';
    typeIcon='';
  } else { 
    typeColor='background:#FFA726;color:#fff';
    typeIcon='';
  }
  
  let ticketNum=t.ticketNumber||'N/A';
  
  let priorityBadge='';
  if(t.priority){
    let priorityColor='';
    if(t.priority==='Urgent') priorityColor='background:#dc3545;color:#fff';
    else if(t.priority==='High') priorityColor='background:#fd7e14;color:#fff';
    else if(t.priority==='Normal') priorityColor='background:#ffc107;color:#000';
    else priorityColor='background:#28a745;color:#fff';
    priorityBadge=`<div style="${priorityColor};padding:5px;border-radius:4px;margin:5px 0;font-size:12px;font-weight:bold">Priority: ${t.priority}</div>`;
  }
  
  return `
    <div class="card">
      <div style="background:#007bff;color:#fff;padding:6px;border-radius:4px;margin-bottom:8px;font-weight:bold"> Ticket: ${ticketNum}</div>
      <strong>${t.lift.client} - ${t.lift.lift}</strong>
      <div style="${typeColor};padding:8px;border-radius:4px;margin:5px 0;font-weight:bold">${typeIcon} ${jobType}</div>
      ${priorityBadge}
      ${inProgressBadge}
      ${faultyBadge}
      ${overdue}
      <div class="address-text"> ${t.lift.address}</div>
      <button onclick="openMap('${t.lift.address}')" class="btn-small map-link"> Open in Google Maps</button>
      <div style="margin:10px 0">
        <strong>Instructions:</strong> ${t.note || 'No specific instructions'}
      </div>
      <div style="margin:10px 0">
        <strong>Scheduled:</strong> ${t.scheduledDate}
      </div>
      ${ticketPhotosHtml}
      ${currentNotesHtml}
      ${historyHtml}
      <button onclick="openDocumentsModal('${t.lift.lift}',true)" class="btn-small" style="background:#6f42c1;color:#fff;margin-bottom:8px"> View Diagrams & Manuals</button>
      <button onclick="openNoteModal(${i})" class="btn-success">Add Note & Complete</button>
    </div>
  `;
}

function openNoteModal(ticketIdx){
  currentTicketIndex=ticketIdx;
  document.getElementById('serviceNote').value='';
  document.getElementById('markFaulty').checked=false;
  document.getElementById('markIncomplete').checked=false;
  document.getElementById('noteModal').style.display='block';
}

function closeNoteModal(){
  document.getElementById('noteModal').style.display='none';
  currentTicketIndex=-1;
}

function completeJob(){
  if(currentTicketIndex===-1) return;
  
  let note=document.getElementById('serviceNote').value;
  let markFaulty=document.getElementById('markFaulty').checked;
  let markIncomplete=document.getElementById('markIncomplete').checked;
  let photoFiles=document.getElementById('servicePhotos').files;
  
  if(!note){
    alert('Please add service notes before completing');
    return;
  }
  
  let ticket=tickets[currentTicketIndex];
  
  // Process photos
  let photos=[];
  let processPhotos=Array.from(photoFiles).map(file=>{
    return new Promise((resolve)=>{
      let reader=new FileReader();
      reader.onload=function(e){
        photos.push({
          data:e.target.result,
          name:file.name,
          date:new Date().toISOString(),
          tech:currentTech
        });
        resolve();
      };
      reader.readAsDataURL(file);
    });
  });
  
  Promise.all(processPhotos).then(()=>{
    if(!ticket.notes) ticket.notes=[];
    ticket.notes.push({
      tech:currentTech,
      text:note,
      time:new Date().toLocaleString(),
      photos:photos
    });
    
    if(!ticket.photos) ticket.photos=[];
    ticket.photos.push(...photos);
    
    if(markIncomplete){
      ticket.isIncomplete=true;
      alert('Job marked as INCOMPLETE - you can return to complete it later');
    } else {
      ticket.status='Done';
      ticket.completed=new Date().toISOString();
      
      let liftIdx=lifts.findIndex(l=>l.lift===ticket.lift.lift);
      if(liftIdx!==-1){
        lifts[liftIdx].lastService=Date.now();
        
        if(markFaulty){
          lifts[liftIdx].isFaulty=true;
          ticket.isFaulty=true;
        } else {
          lifts[liftIdx].isFaulty=false;
          ticket.isFaulty=false;
        }
      }
      
      // WhatsApp notification removed - admin can send manually if needed
    }
    
    save();
    renderTech();
    closeNoteModal();
  });
}

function openMap(address){
  let url=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`;
  window.open(url,'_blank');
}

function sendServiceReminder(phone,client,liftId,address){
  if(!phone){
    alert(' No phone number on file for this client');
    return;
  }
  
  // Clean and format phone number
  phone=phone.replace(/[\s\-\(\)]/g,'');
  if(!phone.startsWith('27') && !phone.startsWith('+')){
    if(phone.startsWith('0')) phone=phone.substring(1);
    phone='27'+phone;
  }
  phone=phone.replace('+','');
  
  // Professional reminder message
  let message=`Hi there! 

This is Econo Home Lifts with a friendly reminder about your lift service.

 *Location:* ${address}
 *Lift ID:* ${liftId}

 Your lift is due for its scheduled maintenance.

We'd like to arrange a convenient time for our technician to visit and ensure everything is running smoothly.

*Please reply with:*
 Your preferred date and time
 Or call us: 044 873 2934

Thank you for choosing Econo Home Lifts! `;
  
  let encodedMessage=encodeURIComponent(message);
  window.open(`https://wa.me/${phone}?text=${encodedMessage}`,'_blank');
}

function sendServiceConfirmation(phone,client,liftId){
  if(!phone){
    alert(' No phone number on file for this client');
    return;
  }
  
  phone=phone.replace(/[\s\-\(\)]/g,'');
  if(!phone.startsWith('27') && !phone.startsWith('+')){
    if(phone.startsWith('0')) phone=phone.substring(1);
    phone='27'+phone;
  }
  phone=phone.replace('+','');
  
  let message=`Hi ${client}! 

Great news - your lift service is complete!

 *Lift ID:* ${liftId}
 *Completed:* ${new Date().toLocaleDateString()}
 Fully inspected and tested
 All systems operational

Your lift is now in excellent working order.

If you experience any issues or have questions, please contact us immediately.

 044 873 2934
 admin@econohomelifts.co.za

Thank you for trusting Econo Home Lifts! `;
  
  let encodedMessage=encodeURIComponent(message);
  window.open(`https://wa.me/${phone}?text=${encodedMessage}`,'_blank');
}

function sendFaultNotification(phone,client,liftId,faultDescription,priority){
  if(!phone){
    alert(' No phone number on file for this client');
    return;
  }
  
  phone=phone.replace(/[\s\-\(\)]/g,'');
  if(!phone.startsWith('27') && !phone.startsWith('+')){
    if(phone.startsWith('0')) phone=phone.substring(1);
    phone='27'+phone;
  }
  phone=phone.replace('+','');
  
  let priorityEmoji=priority==='Urgent'?' URGENT':priority==='High'?' HIGH PRIORITY':' NORMAL';
  let response=priority==='Urgent'?'attend to this IMMEDIATELY':'schedule a repair visit as soon as possible';
  
  let message=`Hi ${client},

${priorityEmoji}
*FAULT NOTIFICATION*

We've received a fault report for your lift:

 *Lift ID:* ${liftId}
 *Issue:* ${faultDescription}
 *Priority:* ${priority}

*Action:* Our team will ${response}.

We'll keep you updated on progress and provide an ETA shortly.

For urgent queries:
 044 873 2934
 admin@econohomelifts.co.za

Econo Home Lifts - Reliable Service `;
  
  let encodedMessage=encodeURIComponent(message);
  window.open(`https://wa.me/${phone}?text=${encodedMessage}`,'_blank');
}

function sendCompletionNotification(phone,client,liftId,techName){
  if(!phone){
    alert(' No phone number on file for this client');
    return;
  }
  
  phone=phone.replace(/[\s\-\(\)]/g,'');
  if(!phone.startsWith('27') && !phone.startsWith('+')){
    if(phone.startsWith('0')) phone=phone.substring(1);
    phone='27'+phone;
  }
  phone=phone.replace('+','');
  
  let message=`Hi ${client}! 

*FAULT RESOLVED*

Good news - the fault on your lift has been fixed!

 *Lift ID:* ${liftId}
 *Technician:* ${techName}
 *Completed:* ${new Date().toLocaleDateString()}

 Issue identified and repaired
 Lift tested and operational
 Safety checks completed

Your lift is now back in full working order.

If you notice any issues, please contact us immediately.

 044 873 2934
 admin@econohomelifts.co.za

Thank you!
Econo Home Lifts `;
  
  let encodedMessage=encodeURIComponent(message);
  window.open(`https://wa.me/${phone}?text=${encodedMessage}`,'_blank');
}

function sendQuickMessage(phone,client,liftId,messageType){
  if(!phone){
    alert(' No phone number on file for this client');
    return;
  }
  
  phone=phone.replace(/[\s\-\(\)]/g,'');
  if(!phone.startsWith('27') && !phone.startsWith('+')){
    if(phone.startsWith('0')) phone=phone.substring(1);
    phone='27'+phone;
  }
  phone=phone.replace('+','');
  
  let message='';
  
  switch(messageType){
    case 'appointment':
      message=`Hi ${client}! 

We'd like to schedule your lift service appointment.

 *Lift ID:* ${liftId}

Please let us know your preferred:
 Date
 Time (morning/afternoon)

Or call us:  044 873 2934

We'll confirm your appointment promptly.

Econo Home Lifts `;
      break;
      
    case 'followup':
      message=`Hi ${client}! 

Following up on the recent service to your lift.

 *Lift ID:* ${liftId}

Is everything working well? 
Any concerns we should address?

Your feedback helps us maintain excellent service.

Reply here or call:  044 873 2934

Econo Home Lifts `;
      break;
      
    case 'inspection':
      message=`Hi ${client}! 

*ANNUAL INSPECTION DUE*

Your lift requires its annual safety inspection.

 *Lift ID:* ${liftId}
 *Legal Requirement*
 *Duration:* Approx 2 hours

We'll contact you to arrange a suitable time.

This ensures your lift remains safe and compliant.

 044 873 2934
Econo Home Lifts `;
      break;
      
    case 'onway':
      message=`Hi ${client}! 

Our technician is on the way to service your lift.

 *Lift ID:* ${liftId}
 *Arriving:* Within 30 minutes

Please ensure access to the lift area is clear.

If you need to reschedule:
 044 873 2934

Econo Home Lifts `;
      break;
  }
  
  let encodedMessage=encodeURIComponent(message);
  window.open(`https://wa.me/${phone}?text=${encodedMessage}`,'_blank');
}

function generateReport(){
  let period=document.getElementById('reportPeriod').value;
  let startDate,endDate=new Date();
  
  if(period==='custom'){
    document.getElementById('customDateRange').style.display='block';
    let start=document.getElementById('reportStartDate').value;
    let end=document.getElementById('reportEndDate').value;
    if(!start||!end) return;
    startDate=new Date(start);
    endDate=new Date(end);
  } else {
    document.getElementById('customDateRange').style.display='none';
    if(period==='today'){
      startDate=new Date();
      startDate.setHours(0,0,0,0);
    } else if(period==='week'){
      startDate=new Date();
      startDate.setDate(startDate.getDate()-7);
    } else if(period==='month'){
      startDate=new Date();
      startDate.setMonth(startDate.getMonth()-1);
    } else if(period==='year'){
      startDate=new Date();
      startDate.setFullYear(startDate.getFullYear()-1);
    }
  }
  
  let filteredTickets=tickets.filter(t=>{
    let ticketDate=new Date(t.completed||t.created);
    return ticketDate>=startDate && ticketDate<=endDate;
  });
  
  let completedTickets=filteredTickets.filter(t=>t.status==='Done');
  let openTickets=filteredTickets.filter(t=>t.status==='Open');
  
  let summary=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0">
      <div style="background:#007bff;color:#fff;padding:15px;border-radius:8px;text-align:center">
        <div style="font-size:32px;font-weight:bold">${completedTickets.length}</div>
        <div>Lifts Serviced</div>
      </div>
      <div style="background:#28a745;color:#fff;padding:15px;border-radius:8px;text-align:center">
        <div style="font-size:32px;font-weight:bold">${openTickets.length}</div>
        <div>Open Jobs</div>
      </div>
      <div style="background:#ffc107;color:#000;padding:15px;border-radius:8px;text-align:center">
        <div style="font-size:32px;font-weight:bold">${filteredTickets.length}</div>
        <div>Total Jobs</div>
      </div>
      <div style="background:#dc3545;color:#fff;padding:15px;border-radius:8px;text-align:center">
        <div style="font-size:32px;font-weight:bold">${lifts.filter(l=>l.isFaulty).length}</div>
        <div>Faulty Lifts</div>
      </div>
    </div>
  `;
  document.getElementById('reportSummary').innerHTML=summary;
  
  let techReportTable=document.getElementById('techReportTable');
  techReportTable.innerHTML='';
  techs.forEach((tech,idx)=>{
    let techTickets=filteredTickets.filter(t=>t.tech===tech.name);
    let completed=techTickets.filter(t=>t.status==='Done').length;
    let open=techTickets.filter(t=>t.status==='Open').length;
    techReportTable.innerHTML+=`<tr><td>${tech.name}</td><td>${completed}</td><td>${open}</td><td>${techTickets.length}</td></tr>`;
  });
  
  let clientReportTable=document.getElementById('clientReportTable');
  clientReportTable.innerHTML='';
  let clientServices={};
  completedTickets.forEach(t=>{
    let client=t.lift.client;
    if(!clientServices[client]){
      clientServices[client]={count:0,lastService:0};
    }
    clientServices[client].count++;
    if(t.completed>clientServices[client].lastService){
      clientServices[client].lastService=t.completed;
    }
  });
  
  Object.keys(clientServices).forEach(client=>{
    let lastService=new Date(clientServices[client].lastService).toLocaleDateString();
    clientReportTable.innerHTML+=`<tr><td>${client}</td><td>${clientServices[client].count}</td><td>${lastService}</td></tr>`;
  });
  
  if(Object.keys(clientServices).length===0){
    clientReportTable.innerHTML='<tr><td colspan="3" style="text-align:center;color:#999">No completed services in this period</td></tr>';
  }
  
  let typeReportTable=document.getElementById('typeReportTable');
  typeReportTable.innerHTML='';
  let typeCounts={};
  completedTickets.forEach(t=>{
    let type=t.jobType||'Service';
    typeCounts[type]=(typeCounts[type]||0)+1;
  });
  
  Object.keys(typeCounts).forEach(type=>{
    let percentage=((typeCounts[type]/completedTickets.length)*100).toFixed(1);
    let icon='';
    if(type==='Faulty') icon='';
    else if(type==='Upgrade') icon='';
    else if(type==='New Install') icon='';
    else if(type==='Inspection') icon='';
    typeReportTable.innerHTML+=`<tr><td>${icon} ${type}</td><td>${typeCounts[type]}</td><td>${percentage}%</td></tr>`;
  });
  
  if(Object.keys(typeCounts).length===0){
    typeReportTable.innerHTML='<tr><td colspan="3" style="text-align:center;color:#999">No completed services in this period</td></tr>';
  }
}

// Admin Management Functions
function addAdmin(){
  let name=document.getElementById('adminName').value.trim();
  let username=document.getElementById('adminUsername').value.trim().toLowerCase();
  let pass=document.getElementById('adminPass').value.trim();
  
  if(!name||!username||!pass){
    alert('Please fill all fields');
    return;
  }
  
  if(admins.find(a=>a.username.toLowerCase()===username)){
    alert('Admin with this username already exists');
    return;
  }
  
  admins.push({name,username,pass});
  save();
  renderAdmin();
  document.getElementById('adminName').value='';
  document.getElementById('adminUsername').value='';
  document.getElementById('adminPass').value='';
  alert('Admin added successfully!');
}

function deleteAdmin(i){
  if(admins.length===1){
    alert('Cannot delete the last admin!');
    return;
  }
  if(confirm('Delete this admin?')){
    admins.splice(i,1);
    save();
    renderAdmin();
  }
}

function changeAdminPassword(){
  let current=document.getElementById('currentPassword').value.trim();
  let newPass=document.getElementById('newPassword').value.trim();
  let confirm=document.getElementById('confirmPassword').value.trim();
  
  if(!current||!newPass||!confirm){
    alert('Please fill all password fields');
    return;
  }
  
  let admin=admins.find(a=>a.username===currentAdmin);
  if(!admin){
    alert('Admin not found');
    return;
  }
  
  if(admin.pass!==current){
    alert('Current password is incorrect');
    return;
  }
  
  if(newPass!==confirm){
    alert('New passwords do not match');
    return;
  }
  
  if(newPass.length<6){
    alert('Password must be at least 6 characters');
    return;
  }
  
  admin.pass=newPass;
  save();
  document.getElementById('currentPassword').value='';
  document.getElementById('newPassword').value='';
  document.getElementById('confirmPassword').value='';
  alert('Password changed successfully!');
}

function exportData(){
  let exportData={
    exportDate:new Date().toISOString(),
    version:'1.0',
    company:'Econo Home Lifts',
    admins:admins,
    lifts:lifts,
    techs:techs,
    tickets:tickets,
    inspections:inspections,
    liftDocuments:liftDocuments
  };
  
  let dataStr=JSON.stringify(exportData,null,2);
  let dataBlob=new Blob([dataStr],{type:'application/json'});
  let url=URL.createObjectURL(dataBlob);
  let link=document.createElement('a');
  link.href=url;
  link.download=`econo-lifts-backup-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  URL.revokeObjectURL(url);
  
  alert(' Data exported successfully!\n\nFile saved to your Downloads folder.\n\nKeep this file safe - you can use it to restore all your data.');
}

function importData(input){
  let file=input.files[0];
  if(!file){
    return;
  }
  
  if(!confirm(' WARNING: This will REPLACE all current data with the data from the backup file.\n\nAre you sure you want to continue?')){
    input.value='';
    return;
  }
  
  let reader=new FileReader();
  reader.onload=function(e){
    try{
      let importedData=JSON.parse(e.target.result);
      
      // Validate the data structure
      if(!importedData.admins||!importedData.lifts||!importedData.techs||!importedData.tickets){
        alert(' Invalid backup file format');
        return;
      }
      
      // Restore data
      admins=importedData.admins||admins;
      lifts=importedData.lifts||[];
      techs=importedData.techs||[];
      tickets=importedData.tickets||[];
      inspections=importedData.inspections||[];
      liftDocuments=importedData.liftDocuments||[];
      
      save();
      
      alert(` Data imported successfully!\n\nRestored:\n- ${lifts.length} lifts\n- ${techs.length} technicians\n- ${tickets.length} tickets\n- ${liftDocuments.length} documents\n\nPage will refresh now.`);
      
      location.reload();
    } catch(err){
      alert(' Error reading backup file: '+err.message);
    }
  };
  
  reader.readAsText(file);
  input.value='';
}


function changeTechPassword(){
  let current=document.getElementById('techCurrentPassword').value.trim();
  let newPass=document.getElementById('techNewPassword').value.trim();
  let confirm=document.getElementById('techConfirmPassword').value.trim();
  
  if(!current||!newPass||!confirm){
    alert('Please fill all password fields');
    return;
  }
  
  let tech=techs.find(t=>t.name===currentTech);
  if(!tech){
    alert('Technician not found');
    return;
  }
  
  if(tech.pass!==current){
    alert('Current password is incorrect');
    return;
  }
  
  if(newPass!==confirm){
    alert('New passwords do not match');
    return;
  }
  
  if(newPass.length<6){
    alert('Password must be at least 6 characters');
    return;
  }
  
  tech.pass=newPass;
  save();
  document.getElementById('techCurrentPassword').value='';
  document.getElementById('techNewPassword').value='';
  document.getElementById('techConfirmPassword').value='';
  alert('Password changed successfully!');
}

// Inspection Management Functions
function viewLiftHistory(liftId){
  let lift=lifts.find(l=>l.lift===liftId);
  if(!lift){
    alert('Lift not found');
    return;
  }
  
  // Get all completed tickets for this lift
  let liftTickets=tickets.filter(t=>t.lift.lift===liftId && t.status==='Done');
  
  // Sort by completion date, newest first
  liftTickets.sort((a,b)=>new Date(b.completed)-new Date(a.completed));
  
  let historyHtml=`
    <div style="background:#e3f2fd;padding:15px;border-radius:6px;margin-bottom:15px">
      <h4 style="margin:0;color:#1976d2"> ${lift.client}</h4>
      <div style="font-size:14px;color:#666;margin-top:5px">
        <strong>Lift ID:</strong> ${lift.lift}<br>
        <strong>Address:</strong> ${lift.address}<br>
        <strong>Service Frequency:</strong> ${lift.frequency} month(s)
      </div>
    </div>
  `;
  
  if(liftTickets.length===0){
    historyHtml+=`<p style="text-align:center;color:#999;padding:20px">No service history available for this lift</p>`;
  } else {
    historyHtml+=`<h4 style="color:#1976d2;margin:15px 0"> Service History (${liftTickets.length} services)</h4>`;
    
    liftTickets.forEach(ticket=>{
      let completedDate=new Date(ticket.completed).toLocaleDateString();
      let jobType=ticket.jobType||'Service';
      let jobIcon='';
      let jobColor='#FFA726';
      
      if(jobType==='Faulty'){ 
        jobIcon='';
        jobColor='#ff6b6b';
      } else if(jobType==='Upgrade'){ 
        jobIcon='';
        jobColor='#9C27B0';
      } else if(jobType==='New Install'){ 
        jobIcon='';
        jobColor='#4CAF50';
      } else if(jobType==='Inspection'){ 
        jobIcon='';
        jobColor='#2196F3';
      }
      
      historyHtml+=`
        <div style="background:#fff;border:1px solid #ddd;border-radius:8px;padding:15px;margin:10px 0">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <div style="background:${jobColor};color:#fff;padding:6px 12px;border-radius:4px;font-weight:bold;font-size:13px">
              ${jobIcon} ${jobType}
            </div>
            <div style="font-size:13px;color:#666">
               ${completedDate}
            </div>
          </div>
          <div style="background:#f5f5f5;padding:8px;border-radius:4px;margin:8px 0">
            <strong>Ticket:</strong> ${ticket.ticketNumber} | <strong>Tech:</strong> ${ticket.tech||'N/A'}
          </div>
      `;
      
      if(ticket.notes && ticket.notes.length>0){
        historyHtml+=`<div style="margin-top:10px"><strong>Service Notes:</strong></div>`;
        ticket.notes.forEach(note=>{
          historyHtml+=`
            <div style="background:#fffacd;padding:10px;border-radius:4px;margin:8px 0;border-left:3px solid #ffc107">
              <div style="font-size:13px"><strong>${note.tech}:</strong> ${note.text}</div>
              <div style="font-size:11px;color:#666;margin-top:5px">${note.time}</div>
          `;
          
          if(note.photos && note.photos.length>0){
            historyHtml+=`<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px">`;
            note.photos.forEach(photo=>{
              historyHtml+=`<img src="${photo.data}" style="width:100%;height:80px;object-fit:cover;border-radius:4px;cursor:pointer" onclick="window.open('${photo.data}','_blank')">`;
            });
            historyHtml+=`</div>`;
          }
          
          historyHtml+=`</div>`;
        });
      }
      
      historyHtml+=`</div>`;
    });
  }
  
  document.getElementById('liftHistoryContent').innerHTML=historyHtml;
  document.getElementById('liftHistoryModal').style.display='block';
}

function closeLiftHistoryModal(){
  document.getElementById('liftHistoryModal').style.display='none';
}

function openDocumentsModal(liftId,readOnly=false){
  currentDocumentLiftId=liftId;
  let lift=lifts.find(l=>l.lift===liftId);
  let docs=liftDocuments.filter(d=>d.liftId===liftId);
  
  let html=`
    <div style="background:#e3f2fd;padding:15px;border-radius:6px;margin-bottom:15px">
      <h4 style="margin:0;color:#1976d2"> ${lift?.client||'Unknown'}</h4>
      <div style="font-size:14px;color:#666;margin-top:5px">
        <strong>Lift ID:</strong> ${liftId}<br>
        <strong>Address:</strong> ${lift?.address||'N/A'}
      </div>
    </div>
  `;
  
  if(!readOnly){
    html+=`
      <div style="background:#f5f5f5;padding:15px;border-radius:6px;margin-bottom:15px">
        <h4 style="margin-top:0"> Upload Documents</h4>
        <input type="text" id="docTitle" placeholder="Document Title (e.g., Wiring Diagram, User Manual)" style="width:100%;margin-bottom:8px">
        <select id="docType" style="width:100%;margin-bottom:8px">
          <option value="Diagram"> Diagram</option>
          <option value="Manual"> User Manual</option>
          <option value="Schematic"> Schematic</option>
          <option value="Certificate"> Certificate</option>
          <option value="Other"> Other</option>
        </select>
        <input type="file" id="docFile" accept=".pdf,.jpg,.jpeg,.png,.gif" style="width:100%;margin-bottom:8px">
        <button onclick="uploadDocument()" class="btn-success">Upload Document</button>
      </div>
    `;
  }
  
  html+=`<h4 style="color:#1976d2;margin:15px 0"> Available Documents (${docs.length})</h4>`;
  
  if(docs.length===0){
    html+=`<p style="text-align:center;color:#999;padding:20px">No documents uploaded for this lift yet</p>`;
  } else {
    docs.forEach((doc,i)=>{
      let typeIcon='';
      if(doc.type==='Diagram') typeIcon='';
      else if(doc.type==='Manual') typeIcon='';
      else if(doc.type==='Schematic') typeIcon='';
      else if(doc.type==='Certificate') typeIcon='';
      
      let uploadedDate=new Date(doc.uploadedDate).toLocaleDateString();
      
      html+=`
        <div style="background:#fff;border:1px solid #ddd;border-radius:8px;padding:15px;margin:10px 0">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:bold;font-size:16px">${typeIcon} ${doc.title}</div>
              <div style="font-size:13px;color:#666;margin-top:5px">
                Type: ${doc.type} | Uploaded: ${uploadedDate} by ${doc.uploadedBy}
              </div>
            </div>
          </div>
          <div style="margin-top:10px">
            <button onclick="viewDocument(${i})" class="btn-small" style="background:#007bff;color:#fff"> View</button>
            <button onclick="downloadDocument(${i})" class="btn-small" style="background:#28a745;color:#fff"> Download</button>
            ${!readOnly?`<button onclick="deleteDocument(${i})" class="btn-small btn-danger"> Delete</button>`:''}
          </div>
        </div>
      `;
    });
  }
  
  document.getElementById('documentsContent').innerHTML=html;
  document.getElementById('documentsModal').style.display='block';
}

function closeDocumentsModal(){
  document.getElementById('documentsModal').style.display='none';
  currentDocumentLiftId='';
}

function uploadDocument(){
  let title=document.getElementById('docTitle').value.trim();
  let type=document.getElementById('docType').value;
  let fileInput=document.getElementById('docFile');
  let file=fileInput.files[0];
  
  if(!title){
    alert('Please enter a document title');
    return;
  }
  
  if(!file){
    alert('Please select a file to upload');
    return;
  }
  
  // Check file size (max 5MB)
  if(file.size>5*1024*1024){
    alert('File size must be less than 5MB');
    return;
  }
  
  let reader=new FileReader();
  reader.onload=function(e){
    liftDocuments.push({
      liftId:currentDocumentLiftId,
      title:title,
      type:type,
      fileName:file.name,
      fileData:e.target.result,
      uploadedDate:new Date().toISOString(),
      uploadedBy:currentAdmin||currentTech
    });
    
    save();
    openDocumentsModal(currentDocumentLiftId); // Refresh the modal
    alert('Document uploaded successfully!');
  };
  
  reader.readAsDataURL(file);
}

function viewDocument(docIndex){
  let docs=liftDocuments.filter(d=>d.liftId===currentDocumentLiftId);
  let doc=docs[docIndex];
  
  if(doc){
    // Open in new window
    let w=window.open('','_blank');
    if(doc.fileData.startsWith('data:application/pdf')){
      w.document.write(`<iframe src="${doc.fileData}" style="width:100%;height:100vh;border:none"></iframe>`);
    } else {
      w.document.write(`<img src="${doc.fileData}" style="max-width:100%;height:auto">`);
    }
  }
}

function downloadDocument(docIndex){
  let docs=liftDocuments.filter(d=>d.liftId===currentDocumentLiftId);
  let doc=docs[docIndex];
  
  if(doc){
    let a=document.createElement('a');
    a.href=doc.fileData;
    a.download=doc.fileName;
    a.click();
  }
}

function deleteDocument(docIndex){
  if(!confirm('Delete this document?')) return;

  let docs=liftDocuments.filter(d=>d.liftId===currentDocumentLiftId);
  let doc=docs[docIndex];

  if(doc){
    let globalIndex=liftDocuments.findIndex(d=>d.liftId===doc.liftId && d.fileName===doc.fileName && d.uploadDate===doc.uploadDate);
    if(globalIndex===-1) return;
    liftDocuments.splice(globalIndex,1);
    save();
    openDocumentsModal(currentDocumentLiftId); // Refresh
    alert('Document deleted');
  }
}


function renderInspections(){
  let inspectionTable=document.getElementById('inspectionTable');
  if(!inspectionTable) return;
  
  inspectionTable.innerHTML='';
  
  lifts.forEach((lift,idx)=>{
    // Get or create inspection record
    let inspection=inspections.find(i=>i.liftId===lift.lift)||{
      liftId:lift.lift,
      lastInspection:null,
      nextDue:null
    };
    
    let lastInsp=inspection.lastInspection?new Date(inspection.lastInspection).toLocaleDateString():'Never';
    let nextDue=inspection.nextDue?new Date(inspection.nextDue):null;
    let nextDueStr=nextDue?nextDue.toLocaleDateString():'Not scheduled';
    
    let daysUntil='N/A';
    let statusClass='';
    let status='';
    
    if(nextDue){
      let today=new Date();
      let diff=Math.ceil((nextDue-today)/(1000*60*60*24));
      daysUntil=diff;
      
      if(diff<0){
        status=' OVERDUE';
        statusClass='status-overdue';
      } else if(diff<=30){
        status=' Due Soon';
        statusClass='status-open';
      } else {
        status=' On Track';
        statusClass='status-done';
      }
    }
    
    inspectionTable.innerHTML+=`
      <tr class="${statusClass}">
        <td>${lift.client}</td>
        <td>${lift.lift}</td>
        <td>${lastInsp}</td>
        <td>${nextDueStr}</td>
        <td>${daysUntil}</td>
        <td>${status}</td>
        <td>
          <button class="btn-small btn-success" onclick="recordInspection(${idx})">Record Inspection</button>
        </td>
      </tr>
    `;
  });
}

function recordInspection(liftIdx){
  let lift=lifts[liftIdx];
  let date=prompt('Enter inspection date (YYYY-MM-DD):',new Date().toISOString().split('T')[0]);
  
  if(!date) return;
  
  let inspectionDate=new Date(date);
  let nextDue=new Date(inspectionDate);
  nextDue.setFullYear(nextDue.getFullYear()+1); // Annual inspection
  
  let inspIdx=inspections.findIndex(i=>i.liftId===lift.lift);
  if(inspIdx===-1){
    inspections.push({
      liftId:lift.lift,
      lastInspection:inspectionDate.toISOString(),
      nextDue:nextDue.toISOString()
    });
  } else {
    inspections[inspIdx].lastInspection=inspectionDate.toISOString();
    inspections[inspIdx].nextDue=nextDue.toISOString();
  }
  
  save();
  renderInspections();
  alert(`Inspection recorded for ${lift.lift}. Next due: ${nextDue.toLocaleDateString()}`);
}

// Dashboard Functions - Zoho/Monday Style
function renderDashboard(){
  updateKPIs();
  renderActivityFeed();
  renderUpcomingTasks();
  renderCharts();
}

function updateKPIs(){
  // Total Lifts
  document.getElementById('kpi-total-lifts').textContent=lifts.length;
  
  // Open Tickets
  let openTickets=tickets.filter(t=>t.status==='Open' || t.status==='In Progress').length;
  document.getElementById('kpi-open-tickets').textContent=openTickets;
  document.getElementById('kpi-tickets-change').textContent=`${openTickets} pending`;
  
  // Completed This Month
  let thisMonth=new Date().getMonth();
  let thisYear=new Date().getFullYear();
  let completedMonth=tickets.filter(t=>{
    if(t.status==='Done' && t.completed){
      let d=new Date(t.completed);
      return d.getMonth()===thisMonth && d.getFullYear()===thisYear;
    }
    return false;
  }).length;
  document.getElementById('kpi-completed-month').textContent=completedMonth;
  
  // Overdue Services
  let overdue=lifts.filter(l=>{
    let daysSince=Math.floor((Date.now()-l.lastService)/(1000*60*60*24));
    let dueIn=l.frequency*30-daysSince;
    return dueIn<0;
  }).length;
  document.getElementById('kpi-overdue').textContent=overdue;
  document.getElementById('kpi-overdue-change').textContent=overdue>0?'Action needed':'All up to date';
  
  // Active Techs
  document.getElementById('kpi-active-techs').textContent=techs.length;
  
}

function renderActivityFeed(){
  let feed=document.getElementById('activity-feed');
  let activities=[];
  
  // Recent completed tickets
  tickets.filter(t=>t.status==='Done').sort((a,b)=>new Date(b.completed)-new Date(a.completed)).slice(0,10).forEach(t=>{
    activities.push({
      type:'completed',
      icon:'',
      text:`Service completed for ${t.lift.client} - ${t.lift.lift}`,
      time:new Date(t.completed),
      tech:t.tech||'Unknown'
    });
  });
  
  // Recent faulty reports
  tickets.filter(t=>t.isFaulty).slice(0,5).forEach(t=>{
    activities.push({
      type:'fault',
      icon:'',
      text:`Fault reported for ${t.lift.client} - ${t.lift.lift}`,
      time:new Date(t.scheduledDate),
      priority:t.priority||'Normal'
    });
  });
  
  // Sort by time
  activities.sort((a,b)=>b.time-a.time);
  
  feed.innerHTML='';
  if(activities.length===0){
    feed.innerHTML='<p style="color:var(--text-muted);text-align:center;padding:20px">No recent activity</p>';
  } else {
    activities.slice(0,8).forEach(a=>{
      let timeAgo=getTimeAgo(a.time);
      feed.innerHTML+=`
        <div class="activity-item">
          <span class="activity-icon" style="background:${a.type==='completed'?'var(--accent-secondary)':'var(--accent-danger)'}">${a.icon}</span>
          <strong>${a.text}</strong>
          ${a.tech?`<br><small>By ${a.tech}</small>`:''}
          ${a.priority?`<br><small>Priority: ${a.priority}</small>`:''}
          <div class="activity-time">${timeAgo}</div>
        </div>
      `;
    });
  }
}

function renderUpcomingTasks(){
  let upcoming=document.getElementById('upcoming-tasks');
  let today=new Date();
  let weekLater=new Date(today.getTime()+7*24*60*60*1000);
  
  let tasks=tickets.filter(t=>{
    if(t.status!=='Open' && t.status!=='In Progress') return false;
    let sched=new Date(t.scheduledDate);
    return sched>=today && sched<=weekLater;
  }).sort((a,b)=>new Date(a.scheduledDate)-new Date(b.scheduledDate));
  
  upcoming.innerHTML='';
  if(tasks.length===0){
    upcoming.innerHTML='<p style="color:var(--text-muted);text-align:center;padding:20px">No upcoming tasks this week</p>';
  } else {
    tasks.forEach(t=>{
      let daysUntil=Math.ceil((new Date(t.scheduledDate)-today)/(1000*60*60*24));
      let urgency=daysUntil===0?' Today':daysUntil===1?' Tomorrow':` In ${daysUntil} days`;
      upcoming.innerHTML+=`
        <div class="activity-item" style="border-left-color:${daysUntil===0?'var(--accent-danger)':daysUntil===1?'var(--accent-warning)':'var(--accent-secondary)'}">
          <strong>${t.lift.client}</strong><br>
          <small>${t.lift.lift} | ${t.jobType||'Service'}</small><br>
          <small>Tech: ${t.tech||'Unassigned'}</small>
          <div class="activity-time">${urgency}</div>
        </div>
      `;
    });
  }
}

function renderCharts(){
  // Only load charts if Chart.js is available and dashboard is visible
  if(typeof Chart === 'undefined'){
    console.log('Charts will load when Chart.js library is ready');
    return;
  }

  // Services by Type Chart
  let servicesCtx=document.getElementById('servicesChart');
  if(servicesCtx){
    let existing=Chart.getChart(servicesCtx);
    if(existing) existing.destroy();

    let types={};
    tickets.forEach(t=>{
      let type=t.jobType||'Service';
      types[type]=(types[type]||0)+1;
    });

    new Chart(servicesCtx,{
      type:'doughnut',
      data:{
        labels:Object.keys(types),
        datasets:[{
          data:Object.values(types),
          backgroundColor:['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6']
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{
            labels:{color:'#f1f5f9'}
          }
        }
      }
    });
  }

  // Monthly Performance Chart
  let perfCtx=document.getElementById('performanceChart');
  if(perfCtx){
    let existing=Chart.getChart(perfCtx);
    if(existing) existing.destroy();

    let months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    let data=new Array(12).fill(0);
    
    tickets.filter(t=>t.status==='Done' && t.completed).forEach(t=>{
      let month=new Date(t.completed).getMonth();
      data[month]++;
    });
    
    new Chart(perfCtx,{
      type:'bar',
      data:{
        labels:months,
        datasets:[{
          label:'Completed Services',
          data:data,
          backgroundColor:'#3b82f6'
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{
            labels:{color:'#f1f5f9'}
          }
        },
        scales:{
          y:{
            beginAtZero:true,
            ticks:{color:'#cbd5e1'},
            grid:{color:'#334155'}
          },
          x:{
            ticks:{color:'#cbd5e1'},
            grid:{color:'#334155'}
          }
        }
      }
    });
  }
}

function getTimeAgo(date){
  let seconds=Math.floor((new Date()-date)/1000);
  let interval=Math.floor(seconds/31536000);
  if(interval>1) return interval+' years ago';
  interval=Math.floor(seconds/2592000);
  if(interval>1) return interval+' months ago';
  interval=Math.floor(seconds/86400);
  if(interval>1) return interval+' days ago';
  interval=Math.floor(seconds/3600);
  if(interval>1) return interval+' hours ago';
  interval=Math.floor(seconds/60);
  if(interval>1) return interval+' minutes ago';
  return 'Just now';
}

// Kanban Board Functions - Monday.com Style
function renderKanban(){
  populateKanbanFilters();
  updateKanbanBoard();
}

function populateKanbanFilters(){
  let techFilter=document.getElementById('kanban-filter-tech');
  techFilter.innerHTML='<option value="">All Technicians</option>';
  techs.forEach((t,i)=>{
    techFilter.innerHTML+=`<option value="${t.name}">${t.name}</option>`;
  });
}

function updateKanbanBoard(){
  let search=document.getElementById('kanban-search')?.value.toLowerCase()||'';
  let techFilter=document.getElementById('kanban-filter-tech')?.value||'';
  
  let filtered=tickets.filter(t=>{
    let matchSearch=!search || 
      t.lift.client.toLowerCase().includes(search) ||
      t.lift.lift.toLowerCase().includes(search) ||
      (t.ticketNumber||'').toLowerCase().includes(search);
    let matchTech=!techFilter || t.tech==techFilter;
    return matchSearch && matchTech;
  });
  
  let todo=filtered.filter(t=>t.status==='Open');
  let progress=filtered.filter(t=>t.status==='In Progress');
  let done=filtered.filter(t=>t.status==='Done');
  
  renderKanbanColumn('kanban-todo',todo);
  renderKanbanColumn('kanban-progress',progress);
  renderKanbanColumn('kanban-done',done);
  
  document.getElementById('kanban-todo-count').textContent=todo.length;
  document.getElementById('kanban-progress-count').textContent=progress.length;
  document.getElementById('kanban-done-count').textContent=done.length;
}

function renderKanbanColumn(columnId,items){
  let column=document.getElementById(columnId);
  if(!column) return;
  
  column.innerHTML='';
  items.forEach((t,i)=>{
    let ticketIdx=tickets.findIndex(ticket=>ticket.ticketNumber===t.ticketNumber);
    let priority=t.priority||'Normal';
    let priorityColor=priority==='Urgent'?'var(--accent-danger)':priority==='High'?'var(--accent-warning)':'var(--text-muted)';
    
    column.innerHTML+=`
      <div class="kanban-card" draggable="true" ondragstart="drag(event,${ticketIdx})" data-ticket="${ticketIdx}">
        <div class="kanban-card-title">${t.lift.client}</div>
        <div class="kanban-card-meta"> ${t.lift.lift}</div>
        <div class="kanban-card-meta"> ${t.scheduledDate}</div>
        <div class="kanban-card-meta"> ${t.ticketNumber}</div>
        <div class="kanban-card-tags">
          <span class="kanban-tag" style="background:${priorityColor};color:#fff">${priority}</span>
          <span class="kanban-tag">${t.jobType||'Service'}</span>
          ${t.isFaulty?'<span class="kanban-tag" style="background:var(--accent-danger);color:#fff"> Faulty</span>':''}
        </div>
        <div class="kanban-card-footer">
          <small> ${t.tech||'Unassigned'}</small>
          <button onclick="viewTicketDetails(${ticketIdx})" class="btn-small" style="width:auto;padding:4px 8px;font-size:11px">View</button>
        </div>
      </div>
    `;
  });
  
  if(items.length===0){
    column.innerHTML='<p style="color:var(--text-muted);text-align:center;padding:40px">No tickets</p>';
  }
}

function allowDrop(ev){
  ev.preventDefault();
}

function drag(ev,ticketIdx){
  ev.dataTransfer.setData("ticketIdx",ticketIdx);
  ev.target.classList.add('dragging');
  ev.target.addEventListener('dragend',function(){
    this.classList.remove('dragging');
  },{once:true});
}

function drop(ev,newStatus){
  ev.preventDefault();
  let ticketIdxStr=ev.dataTransfer.getData("ticketIdx");
  if(ticketIdxStr!==''){
    let ticketIdx=parseInt(ticketIdxStr);
    if(isNaN(ticketIdx) || ticketIdx<0 || ticketIdx>=tickets.length) return;
    tickets[ticketIdx].status=newStatus;
    if(newStatus==='Done' && !tickets[ticketIdx].completed){
      tickets[ticketIdx].completed=new Date().toISOString();
    }
    save();
    updateKanbanBoard();
    renderAdmin();
  }
}

function viewTicketDetails(ticketIdx){
  openEditTicketModal(ticketIdx);
}

// Calendar Functions - Zoho Style
let currentCalendarDate=new Date();

function renderCalendar(){
  let year=currentCalendarDate.getFullYear();
  let month=currentCalendarDate.getMonth();
  
  document.getElementById('calendar-month-year').textContent=
    new Date(year,month).toLocaleString('default',{month:'long',year:'numeric'});
  
  let grid=document.getElementById('calendar-grid');
  grid.innerHTML='';
  
  // Day headers
  ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(day=>{
    grid.innerHTML+=`<div class="calendar-day-header">${day}</div>`;
  });
  
  // Get first day of month
  let firstDay=new Date(year,month,1).getDay();
  let daysInMonth=new Date(year,month+1,0).getDate();
  let daysInPrevMonth=new Date(year,month,0).getDate();
  
  // Previous month days
  for(let i=firstDay-1;i>=0;i--){
    grid.innerHTML+=`<div class="calendar-day other-month"><div class="calendar-day-number">${daysInPrevMonth-i}</div></div>`;
  }
  
  // Current month days
  for(let day=1;day<=daysInMonth;day++){
    let date=new Date(year,month,day);
    let isToday=date.toDateString()===new Date().toDateString();
    let dayTickets=getTicketsForDate(date);
    
    let eventsHtml='';
    dayTickets.slice(0,3).forEach(t=>{
      let eventClass=t.status==='Done'?'service':t.isFaulty?'overdue':'';
      eventsHtml+=`<div class="calendar-event ${eventClass}" title="${t.lift.client} - ${t.lift.lift}">${t.ticketNumber}</div>`;
    });
    if(dayTickets.length>3){
      eventsHtml+=`<div class="calendar-event" style="background:var(--text-muted)">+${dayTickets.length-3} more</div>`;
    }
    
    grid.innerHTML+=`
      <div class="calendar-day ${isToday?'today':''}" onclick="selectCalendarDay('${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}')">
        <div class="calendar-day-number">${day}</div>
        ${eventsHtml}
      </div>
    `;
  }
  
  // Next month days
  let totalCells=firstDay+daysInMonth;
  let remainingCells=totalCells%7===0?0:(7-totalCells%7);
  for(let day=1;day<=remainingCells;day++){
    grid.innerHTML+=`<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
  }
}

function getTicketsForDate(date){
  let y=date.getFullYear();
  let m=String(date.getMonth()+1).padStart(2,'0');
  let d=String(date.getDate()).padStart(2,'0');
  let dateStr=`${y}-${m}-${d}`;
  return tickets.filter(t=>t.scheduledDate===dateStr);
}

function selectCalendarDay(dateStr){
  let parts=dateStr.split('-');
  let date=new Date(parseInt(parts[0]),parseInt(parts[1])-1,parseInt(parts[2]));
  let dayTickets=getTicketsForDate(date);
  
  let eventsDiv=document.getElementById('calendar-events');
  eventsDiv.innerHTML=`<h4>${date.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}</h4>`;
  
  if(dayTickets.length===0){
    eventsDiv.innerHTML+='<p style="color:var(--text-muted)">No scheduled services for this date</p>';
  } else {
    dayTickets.forEach(t=>{
      eventsDiv.innerHTML+=`
        <div class="activity-item">
          <strong>${t.ticketNumber}: ${t.lift.client}</strong><br>
          <small> ${t.lift.lift} | ${t.jobType||'Service'}</small><br>
          <small> ${t.tech||'Unassigned'}</small><br>
          <small>Status: <span class="status-pill ${t.status.toLowerCase().replace(' ','-')}">${t.status}</span></small>
          <div style="margin-top:8px">
            <button onclick="openEditTicketModal(${tickets.findIndex(ticket=>ticket.ticketNumber===t.ticketNumber)})" class="btn-small btn-secondary" style="width:auto">Edit Ticket</button>
          </div>
        </div>
      `;
    });
  }
}

function changeMonth(direction){
  currentCalendarDate.setMonth(currentCalendarDate.getMonth()+direction);
  renderCalendar();
}

// Update main render function
let originalRenderAdmin=renderAdmin;
renderAdmin=function(){
  originalRenderAdmin();
  if(document.getElementById('dashboard-tab').classList.contains('active')){
    renderDashboard();
  } else if(document.getElementById('kanban-tab').classList.contains('active')){
    renderKanban();
  } else if(document.getElementById('calendar-tab').classList.contains('active')){
    renderCalendar();
  } else if(document.getElementById('faults-tab').classList.contains('active')){
    renderFaults();
  }
};

// Add search functionality for Kanban
if(document.getElementById('kanban-search')){
  document.getElementById('kanban-search').addEventListener('input',updateKanbanBoard);
  document.getElementById('kanban-filter-tech').addEventListener('change',updateKanbanBoard);
}

// Fault Management Functions
function renderFaults(){
  updateFaultStats();
  renderActiveFaults();
  renderResolvedFaults();
  renderFaultTimeline();
}

function updateFaultStats(){
  let faultyTickets=tickets.filter(t=>t.isFaulty);
  let activeFaults=faultyTickets.filter(t=>t.status!=='Done');
  
  // Count by priority
  let urgent=activeFaults.filter(t=>t.priority==='Urgent').length;
  let high=activeFaults.filter(t=>t.priority==='High').length;
  let normal=activeFaults.filter(t=>t.priority==='Normal').length;
  
  // Resolved this month
  let thisMonth=new Date().getMonth();
  let thisYear=new Date().getFullYear();
  let resolved=faultyTickets.filter(t=>{
    if(t.status==='Done' && t.completed){
      let d=new Date(t.completed);
      return d.getMonth()===thisMonth && d.getFullYear()===thisYear;
    }
    return false;
  }).length;
  
  document.getElementById('fault-urgent-count').textContent=urgent;
  document.getElementById('fault-high-count').textContent=high;
  document.getElementById('fault-normal-count').textContent=normal;
  document.getElementById('fault-resolved-count').textContent=resolved;
  
  // Update badge count
  let faultsCount=document.getElementById('faultsCount');
  if(activeFaults.length>0){
    faultsCount.textContent=activeFaults.length;
    faultsCount.style.display='inline-block';
  } else {
    faultsCount.style.display='none';
  }
}

function renderActiveFaults(){
  let list=document.getElementById('active-faults-list');
  let faults=tickets.filter(t=>t.isFaulty && t.status!=='Done');
  
  // Apply filters
  let search=document.getElementById('fault-search')?.value.toLowerCase()||'';
  let priorityFilter=document.getElementById('fault-priority-filter')?.value||'';
  let statusFilter=document.getElementById('fault-status-filter')?.value||'';
  
  faults=faults.filter(t=>{
    let matchSearch=!search || 
      t.lift.client.toLowerCase().includes(search) ||
      t.lift.lift.toLowerCase().includes(search) ||
      (t.note||'').toLowerCase().includes(search);
    let matchPriority=!priorityFilter || t.priority===priorityFilter;
    let matchStatus=!statusFilter || t.status===statusFilter;
    return matchSearch && matchPriority && matchStatus;
  });
  
  // Sort by priority and date
  let priorityOrder={'Urgent':1,'High':2,'Normal':3,'Low':4};
  faults.sort((a,b)=>{
    let priorityDiff=(priorityOrder[a.priority||'Normal']||3)-(priorityOrder[b.priority||'Normal']||3);
    if(priorityDiff!==0) return priorityDiff;
    return new Date(a.scheduledDate)-new Date(b.scheduledDate);
  });
  
  list.innerHTML='';
  if(faults.length===0){
    list.innerHTML='<p style="color:var(--text-muted);text-align:center;padding:40px"> No active faults matching filters</p>';
    return;
  }
  
  faults.forEach(t=>{
    let ticketIdx=tickets.findIndex(ticket=>ticket.ticketNumber===t.ticketNumber);
    let priority=t.priority||'Normal';
    let priorityClass=priority.toLowerCase();
    let daysOpen=Math.floor((Date.now()-new Date(t.scheduledDate))/(1000*60*60*24));
    let tech=t.tech||'Unassigned';
    
    list.innerHTML+=`
      <div class="fault-card ${priorityClass}">
        <div class="fault-header">
          <div class="fault-title"> ${t.lift.client}</div>
          <div class="fault-priority-badge ${priorityClass}">
            ${priority==='Urgent'?'':priority==='High'?'':priority==='Low'?'':''}
            ${priority}
          </div>
        </div>
        
        <div class="fault-meta">
          <div class="fault-meta-item">
            <span class="icon"></span>
            <span><strong>Lift:</strong> ${t.lift.lift}</span>
          </div>
          <div class="fault-meta-item">
            <span class="icon"></span>
            <span><strong>Ticket:</strong> ${t.ticketNumber}</span>
          </div>
          <div class="fault-meta-item">
            <span class="icon"></span>
            <span><strong>Assigned:</strong> ${tech}</span>
          </div>
          <div class="fault-meta-item">
            <span class="icon"></span>
            <span><strong>Reported:</strong> ${t.scheduledDate}</span>
          </div>
          <div class="fault-meta-item">
            <span class="icon"></span>
            <span><strong>Open:</strong> ${daysOpen} day${daysOpen!==1?'s':''}</span>
          </div>
          <div class="fault-meta-item">
            <span class="icon"></span>
            <span><strong>Status:</strong> ${t.status}</span>
          </div>
        </div>
        
        ${t.note?`
          <div class="fault-description">
            <strong> Fault Description:</strong><br>
            ${t.note}
          </div>
        `:''}
        
        <div class="fault-actions">
          <button onclick="openEditTicketModal(${ticketIdx})" class="btn-secondary"> Edit Details</button>
          <button onclick="markFaultInProgress(${ticketIdx})" class="btn-warning" ${t.status==='In Progress'?'disabled':''}>
             ${t.status==='In Progress'?'Already In Progress':'Mark In Progress'}
          </button>
          <button onclick="resolveFault(${ticketIdx})" class="btn-success"> Mark Resolved</button>
          <button onclick="openMap('${t.lift.address}')" class="btn-small" style="background:var(--accent-primary)"> View Location</button>
          <button onclick="sendFaultNotification('${t.lift.phone}','${t.lift.client}','${t.lift.lift}','${(t.note||'Fault reported').replace(/'/g,"\\'")}','${priority}')" class="btn-small" style="background:#25d366;color:#fff"> Notify Client</button>
        </div>
      </div>
    `;
  });
}

function renderResolvedFaults(){
  let list=document.getElementById('resolved-faults-list');
  let resolved=tickets.filter(t=>t.isFaulty && t.status==='Done')
    .sort((a,b)=>new Date(b.completed)-new Date(a.completed))
    .slice(0,10);
  
  list.innerHTML='';
  if(resolved.length===0){
    list.innerHTML='<p style="color:var(--text-muted);text-align:center;padding:40px">No resolved faults yet</p>';
    return;
  }
  
  resolved.forEach(t=>{
    let completedDate=new Date(t.completed).toLocaleDateString();
    let reportedDate=new Date(t.scheduledDate);
    let completedDateTime=new Date(t.completed);
    let resolutionTime=Math.floor((completedDateTime-reportedDate)/(1000*60*60*24));
    
    list.innerHTML+=`
      <div class="activity-item" style="border-left-color:var(--accent-secondary)">
        <strong> ${t.lift.client} - ${t.lift.lift}</strong><br>
        <small> ${t.ticketNumber} |  ${t.tech||'N/A'}</small><br>
        <small> Resolved in ${resolutionTime} day${resolutionTime!==1?'s':''}</small>
        <div class="activity-time">Completed: ${completedDate}</div>
      </div>
    `;
  });
}

function renderFaultTimeline(){
  let ctx=document.getElementById('faultTimelineChart');
  if(!ctx || typeof Chart==='undefined') return;
  let existing=Chart.getChart(ctx);
  if(existing) existing.destroy();
  
  // Get last 6 months of fault data
  let months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  let reported=new Array(6).fill(0);
  let resolved=new Array(6).fill(0);
  let labels=[];
  
  let today=new Date();
  for(let i=5;i>=0;i--){
    let d=new Date(today.getFullYear(),today.getMonth()-i,1);
    labels.push(months[d.getMonth()]);
  }
  
  tickets.filter(t=>t.isFaulty).forEach(t=>{
    let reportMonth=new Date(t.scheduledDate);
    let monthsAgo=Math.floor((today-reportMonth)/(1000*60*60*24*30));
    if(monthsAgo<6 && monthsAgo>=0){
      reported[5-monthsAgo]++;
    }
    
    if(t.completed){
      let completeMonth=new Date(t.completed);
      let monthsAgoComplete=Math.floor((today-completeMonth)/(1000*60*60*24*30));
      if(monthsAgoComplete<6 && monthsAgoComplete>=0){
        resolved[5-monthsAgoComplete]++;
      }
    }
  });
  
  new Chart(ctx,{
    type:'line',
    data:{
      labels:labels,
      datasets:[
        {
          label:'Faults Reported',
          data:reported,
          borderColor:'#ef4444',
          backgroundColor:'rgba(239, 68, 68, 0.1)',
          tension:0.4
        },
        {
          label:'Faults Resolved',
          data:resolved,
          borderColor:'#10b981',
          backgroundColor:'rgba(16, 185, 129, 0.1)',
          tension:0.4
        }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{
        legend:{
          labels:{color:'#f1f5f9'}
        }
      },
      scales:{
        y:{
          beginAtZero:true,
          ticks:{color:'#cbd5e1'},
          grid:{color:'#334155'}
        },
        x:{
          ticks:{color:'#cbd5e1'},
          grid:{color:'#334155'}
        }
      }
    }
  });
}

function filterFaults(){
  renderActiveFaults();
}

function markFaultInProgress(ticketIdx){
  tickets[ticketIdx].status='In Progress';
  save();
  renderFaults();
  renderAdmin();
  alert('Fault marked as In Progress');
}

function resolveFault(ticketIdx){
  if(!confirm('Mark this fault as resolved? This will mark it as Done.')){
    return;
  }
  
  tickets[ticketIdx].status='Done';
  tickets[ticketIdx].completed=new Date().toISOString();
  
  // Update the lift's faulty status
  let liftIdx=lifts.findIndex(l=>l.lift===tickets[ticketIdx].lift.lift);
  if(liftIdx!==-1){
    lifts[liftIdx].isFaulty=false;
  }
  
  save();
  renderFaults();
  renderAdmin();
  alert(' Fault resolved successfully!');
}

//  App Startup (Firebase) 
window.onload = async function() {
  showLoader('Connecting to cloud...');

  // Load data from Firebase
  const cloudData = await loadFromFirebase();

  if (!cloudData) {
    // First ever launch  no data in Firebase yet, seed with demo data
    await new Promise(resolve => {
      initializeDemoData();
      setTimeout(resolve, 1000); // give save() time to push to Firebase
    });
  } else {
    // Populate in-memory arrays from cloud
    if (cloudData.admins)          admins          = cloudData.admins;
    if (cloudData.lifts)           lifts           = cloudData.lifts;
    if (cloudData.techs)           techs           = cloudData.techs;
    if (cloudData.tickets)         tickets         = cloudData.tickets;
    if (cloudData.inspections)     inspections     = cloudData.inspections;
    if (cloudData.liftDocuments)   liftDocuments   = cloudData.liftDocuments;
    if (cloudData.whatsappSettings) whatsappSettings = cloudData.whatsappSettings;
    if (cloudData.techLocations)   techLocations   = cloudData.techLocations;

    // Migration: ensure Ivan Uys technician exists
    if (!techs.find(t => t.username === 'ivan')) {
      techs.push({name:"Ivan Uys", username:"ivan", pass:"1986"});
      save();
    }
  }

  // Start real-time sync so all phones update instantly
  startRealtimeSync();

  // Auto-login if user chose "Remember Me" on this device
  let remembered = localStorage.getItem('rememberedUser');
  if (remembered) {
    try {
      let user = JSON.parse(remembered);
      if (user.type === 'admin') {
        let admin = admins.find(a => a.username.toLowerCase() === user.username.toLowerCase() && a.pass === user.pass);
        if (admin) {
          document.getElementById('loginType').value = 'admin';
          document.getElementById('username').value = user.username;
          document.getElementById('password').value = user.pass;
          document.getElementById('rememberMe').checked = true;
          hideLoader();
          login();
          return;
        }
      } else if (user.type === 'tech') {
        let t = techs.find(x => x.username.toLowerCase() === user.username.toLowerCase() && x.pass === user.pass);
        if (t) {
          document.getElementById('loginType').value = 'tech';
          document.getElementById('username').value = user.username;
          document.getElementById('password').value = user.pass;
          document.getElementById('rememberMe').checked = true;
          currentTech = user.name;
          hideLoader();
          login();
          return;
        }
      }
    } catch(e) {
      localStorage.removeItem('rememberedUser');
    }
  }

  hideLoader();

  // PWA Installation Support
  let deferredPrompt;
  let installButton;
  
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    
    // Create install button
    if(!document.getElementById('pwa-install-btn')){
      installButton = document.createElement('button');
      installButton.id = 'pwa-install-btn';
      installButton.innerHTML = ' Install App';
      installButton.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        font-weight: 700;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        cursor: pointer;
        z-index: 9999;
        animation: pulse 2s infinite;
      `;
      
      installButton.addEventListener('click', async () => {
        if(deferredPrompt){
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if(outcome === 'accepted'){
            console.log(' PWA installed successfully!');
            installButton.style.display = 'none';
          }
          deferredPrompt = null;
        }
      });
      
      document.body.appendChild(installButton);
    }
  });
  
  window.addEventListener('appinstalled', () => {
    if(installButton){
      installButton.style.display = 'none';
    }
    console.log(' PWA was installed!');
  });
  
  // Service Worker registration (for PWA offline support)
  if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
    if (window.location.hostname !== '') {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  }
}; // end window.onload
</script>
</body>
</html>